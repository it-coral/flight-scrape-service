<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Pex Search Result</title>
		{% include "flightsearch/header.html" %}
		{% load staticfiles %}
		<body>
			<div class="">
				<div class="jumbotron">
					<div class="container-fluid">
							{% if search %}
							{% for searchrow in search %}
							<div class="col-xs-12 mvb10px">
								<div class="col-xs-12 nopadding">
									<form class="form-inline" method="post" action="searchLoadingPage">
										{% csrf_token %}
									  <div class="form-group">
									    <label class="sr-only" for="exampleInputEmail3">Source</label>
									    <input type="text" class="form-control" value="{{searchrow.source}}" name="fromMain">
									  </div>
									   <div class="form-group">
									    <h4>&#10230;</h4>
									  </div>
									  <div class="form-group">
									    <label class="sr-only" for="exampleInputPassword3">Destination</label>
									    <input type="text" class="form-control" value="{{searchrow.destination}}" name="toMain">
									  </div>
									  <div class="form-group">
										 <label class="sr-only" for="exampleInputPassword3">Departure</label>
											<div class="inner-addon left-addon date" id="dp1">
										    <i class="glyphicon glyphicon-calendar"></i>
										    <input type="text" class="form-control" value="{{searchrow.traveldate|date:"m/d/Y"}}" id="departuredate" name="deptdate">
									  		</div>
									  </div>
									  {%if searchrow.returndate%}
									  <div class="form-group">
									    <label class="sr-only" for="exampleInputPassword3">return</label>
									    <div class="inner-addon left-addon date" id="dp2">
									    <i class="glyphicon glyphicon-calendar"></i>
									    <input type="text" class="form-control" value="{{searchrow.returndate|date:"m/d/Y"}}" id="return" name="returndate">
									  </div>
									  </div>
									  {%endif%}
									  <div class="form-group">
									    <button class="btn btn-success btn-sm">Search</button>
									  </div>
									</form>
									<!--
									<h4>{% if action == 'return' %}Return : {% endif %}{{searchrow.source}} &#10230; {{searchrow.destination}} </h4>
									<h4> {{searchrow.traveldate}}<!--<input type="text" id="datepicker" name="date" value="{{searchdate}}"></h4>-->
								</div>
							</div>
							{%endfor %}
							{% endif %}
						<div class="col-md-12 col-xs-12">
							<div class="col-md-2 col-xs-12 nopadding">
								<form action="search" method="post">
									{% csrf_token %}
									{% if search %}
										{% for searchrow in search %}
									<input type="hidden" name="action" value="{{action}}">
									<input type="hidden" name="tax" id ="fltrprice" {% if request.GET.price %} value="{{request.GET.tax}}" {%else%} value="{{tax}}"{% endif%}>
									<input type="hidden" name="price" id ="fltrprice" {% if request.GET.price %} value="{{request.GET.price}}" {%else%} value="{{minprice}}"{% endif%}>	
									<input type="hidden" name="searchkeyval" value="{{ searchrow.searchid }}" id="searchkey"/>
									{% if returndata %}
									<input type="hidden" name="returnkey"  value="{{returndata}}" id="returnkey"/>
									{%endif%}
									{%endfor %}
									{% endif %}
									<div class="col-md-12 col-xs-12 nopadding form-side">
										<div class="priceRangeInfo">
											DEPARTURE TIME

											<div class="slider slider-blue mvt15px" data-postfix=" $" data-min="0" data-max="2000" data-min-val="400" data-max-val="1400" data-fill="#sample-field-2" id="depart"></div>
											<span id="time"></span>
											<input type="hidden" name="depaturemin" id="depaturemin" value=""/>
											<input type="hidden" name="depaturemax" id="depaturemax" value=""/>
										</div>
										
										<div class="priceRangeInfo mvt15px">
											ARRIVAL TIME
											<div class="slider slider-blue mvt15px" data-postfix=" $" data-min="0" data-max="2000" data-min-val="400" data-max-val="1400" data-fill="#sample-field-2" id="arive"></div>
											<span id="arivaltime"></span>
										</div>
										<input type="hidden" name="arivalmin" id="arivalmin" value=""/>
										<input type="hidden" name="arivalmax" id="arivalmax" value=""/>
									</div>
									<div class="col-md-12 col-xs-12 nopadding form-side">
										<p>
											NUMBER OF STOPS
										</p>

										<div class="checkbox">
											<label>
												<input type='checkbox' name="stoppage" value="NONSTOP" {% for row in filterkey.stoppage %} {% if row == 'NONSTOP'%} checked="checked" {% endif %}{%endfor %}>
												<span></span> NONSTOP </label>
										</div>
										<div class="checkbox">
											<label>
												<input type='checkbox' name="stoppage" value="1 STOP" {% for row in filterkey.stoppage %} {% if row == '1 STOP'%} checked="checked" {% endif %}{%endfor %}>
												<span></span> 1 STOP </label>
										</div>
										<div class="checkbox">
											<label>
												<input type='checkbox' name="stoppage" value="2 STOPS" {% for row in filterkey.stoppage %} {% if row == '2 STOPS'%} checked="checked" {% endif %}{%endfor %}>
												<span></span> 2+ STOPS </label>
										</div>

									</div>
									<div class="col-md-12 col-xs-12 nopadding form-side">
									<p>AIRLINES</p>
									<div class="checkbox">
									<label>
									<input type='checkbox' name="airlines" value="delta" {% for row in filterkey.datasource %} {% if row == 'delta'%} checked="checked" {% endif %}{%endfor %}>
									<span></span>
									DELTA AIRLINES
									</label>
									</div>
									<div class="checkbox" >
									<label>
									<input type='checkbox' name="airlines" value="united" {% for row in filterkey.datasource %} {% if row == 'united'%} checked="checked" {% endif %}{%endfor %}>
									<span></span>
									UINTED AIRLINES
									</label>
									</div>
									
									</div>
									<div class="col-md-12 col-xs-12 nopadding form-side">
										<p>
											CABIN
										</p>
										<div class="col-md-10 col-xs-10 nopadding form-side">
											<p>
												BUSINESS/FIRST
											</p>
										<div class="checkbox">
											<label>
												<input type='checkbox' name="cabintype2" value="Multiple"  {% for row in filterkey.business %} {% if row == 'Multiple'%} checked="checked" {% endif %} {%endfor %}>
												<span></span>MULTIPLE CABINS</label>
										</div>
										<div class="checkbox">
											<label>
												<input type='checkbox' name="cabintype2" value="Business" {% for row in filterkey.business %} {% if row == 'Business'%} checked="checked" {% endif %}{%endfor %}>
												<span></span> BUSINESS </label>
										</div>
										<div class="checkbox">
											<label>
												<input type='checkbox' name="cabintype2" value="First" {% for row in filterkey.business %} {% if row == 'First'%} checked="checked" {% endif %}{%endfor %}>
												<span></span> FIRST </label>
										</div>

									</div>
									</div>
									<input type="hidden" name="search" value="search">
									<div class="col-md-12 col-xs-12 nopadding form-side">
										<input type="submit" value="SEARCH" class="btn btn-default">
									</div>
								</form>
							</div>
							<div class="col-md-8 col-xs-12 ">
								
								{% if selectedrow %}
								
								<div class="col-xs-12 selected-flights bgclr">
									<div class="col-md-5 col-xs-12 nopadding">
										<div class="col-xs-12 nopadding">
											<div class="col-xs-12 nopadding">
												<div class="arrivel col-sm-5 nopadding">
													<p>
														{{selectedrow.origin}}
													</p>
													<p>
														{{selectedrow.departure}}
													</p>
												</div>
												<div class="arrow-div col-sm-2 nopadding">&xrarr;</div>
												<div class="arrivel-2 col-sm-5 nopadding text-right">
													<p>
														{{selectedrow.destination}}
													</p>
													<p>
														{{selectedrow.arival}}
													</p>
												</div>
											</div>
										</div>
									</div>
									
									<div class="col-md-2 col-xs-5 text-center">
										{% if selectedrow.datasource == "united" %}
										<img src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image">{% endif %}
										{% if selectedrow.datasource == "delta" %}
										<img src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %}
										<h5>OUTBOUND</h5>
									</div>
									
									<div class="col-md-5 col-xs-12 nopadding">
										<div class="col-xs-12 nopadding">
											<div class="col-sm-5 col-xs-12 nopadding">
												<p class="flight-name">
													{{selectedrow.flighno}} 
												</p>
												<p class="stops-dur"><span>{{selectedrow.stoppage}}</span> <span>{{row.duration}}</span></p>												
											</div>
											<div class="col-sm-7 col-xs-12 nopadding">
												<div class="col-xs-12 nopadding text-center">
													{% if selectedrow.cabintype1 and selectedrow.maincabin %}
													<h5 class="econo"> {{row.cabintype1}} </h5>
													<div class="col-xs-12 nopadding mvb10px na-ra">
														<p class="flight-rate">
															{% if selectedrow.datasource == "delta" %}
															{{selectedrow.maincabin|add:minprice}} {%else%}{{selectedrow.maincabin}} {%endif%} Miles
														</p>
														<p>+</p>
														<h6 class="nomt">${{selectedrow.maintax}}</h6>
													</div>
													
													{% endif %}
												</div>												
											</div>											
										</div>
									</div>
									
									<div class="col-xs-12 nopadding pop-hover">
											<a class="" role="button" data-toggle="collapse" href="#{{selectedrow.rowid}}" aria-expanded="false" aria-controls="collapseExample">SHOW DETAILS</a>
											<div class="collapse" id="{{selectedrow.rowid}}">
												<div class="well">
													<h2>DEPART</h2>
													<p>
														COMPANY FLIGHT (ECO)
													</p>
													<div class="table-responsive table-date-search">
														<table class="table">
															<tr>
																<td>{{selectedrow.departure}}</td>
																<td>{{searchdate}}</td>
																<td>{{selectedrow.origin}}</td>
															</tr>
															<tr>
																<td>{{selectedrow.arival}}</td>
																<td>{{searchdate}}</td>
																<td>{{selectedrow.destination}}</td>
															</tr>
														</table>
													</div>
													<a href="#">share</a>
												</div>
											</div>
										</div>
								</div>
							{% endif %}
							
							{% if data %}
								{% if data == '' %}
								<h4>Sorry, No Flight Found </h4>
								{% endif %}
								{% for row in data %}
								<div class="col-md-12 col-xs-5 centr-info">
									<div class="col-md-5 col-xs-12 nopadding">
										<div class="col-xs-12 nopadding">
											<div class="col-xs-12 nopadding">
												<div class="col-sm-4 col-xs-12 nopadding">
													<div class="col-xs-12 nopadding text-center mvb10px">
														{% if row.datasource == "united" %}
														<img src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image">{% endif %}
														{% if row.datasource == "delta" %}
														<img src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %}
													</div>
													<p class="flight-name">
														{{row.flighno}} <!--FIRST FLIGHT OPTION RESULT-->
													</p>
												</div>
												<div class="col-sm-8 col-xs-12">
													<div class="col-xs-12 nopadding non-stop">
														<p>
															{{row.stoppage}}
														</p>
														<p>
															{{row.duration}}
														</p>

													</div>
												</div>
											</div>
											<div class="col-xs-12 nopadding">
												<div class="arrivel col-sm-5 nopadding">
													<p>
														{{row.origin}}
													</p>
													<p>
														{{row.departure}}
													</p>
												</div>
												<div class="arrow-div col-sm-2 nopadding">&xrarr;</div>
												<div class="arrivel-2 col-sm-5 nopadding text-right">
													<p>
														{{row.destination}}
													</p>
													<p>
														{{row.arival}}
													</p>
												</div>

											</div>
										</div>
									</div>
									
									<div class="col-md-7 col-xs-12 nopadding">
										<div class="col-md-12 col-xs-12 nopadding">
											<div class="col-sm-4 col-xs-12 nopl">
												<div class="col-xs-12 nopadding text-center">
													{% if row.cabintype1 and row.maincabin %}
													<h5 class="econo"> {{row.cabintype1}} </h5>
													<div class="col-xs-12 nopadding mvb10px na-ra">
														<p class="flight-rate">
															{% if row.datasource == "delta" %}
															{{row.maincabin|add:minprice}} {%else%}{{row.maincabin}} {%endif%} Miles
														</p>
														<p>+</p>
														<h6 class="nomt">${{row.maintax}}</h6>
													</div>
													{% if action == 'depart' %}
													<div>
													<form action="getsearchresult" method="get">
														{% csrf_token %}
														<input type="hidden" name="rowid"  value="{{row.rowid}}">
														<input type="hidden" name="price"  value="{{row.maincabin}}">
														<input type="hidden" name="tax"  value="{{row.maintax}}">
														<input type="hidden" name="action"  value="return">
														<input type="hidden" name="keyid"  value="{{row.searchkeyid}}">
														<input type="hidden" name="returnkey"  {% if returndata %} value="{{returndata}}"{%endif%}>
														<button type"submit" value="{{searchrow.searchid}}" name="return" id="return">SELECT</button>
													</form>
													</div>
													{% else %}
													<div>
													<span class="btn btn-default">SELECT</span>
													</div>
													{%endif%}
													
													{% else %}
													<div class="col-xs-12 nopadding text-center">
														<h5>Not Available </h5>
													</div>
													{% endif %}
												</div>
											</div>
											
											<div class="col-sm-4 col-xs-12 nopadding">
												<div class="col-xs-12 nopadding text-center">
													{% if row.cabintype2 and row.firstclass %}
													<h5 class="econo">{{row.cabintype2}}</h5>
													<div class="col-xs-12 nopadding mvb10px na-ra">
														<p class="flight-rate">
															{% if row.datasource == "delta" %}
															{{row.firstclass|add:minprice}} {%else%}{{row.firstclass}} {%endif%} Miles
														</p>
														<p>+</p>
														<h6>${{row.firsttax}}</h6>
													</div>
													{% if action == 'depart' %}
													<div>
													<form action="getsearchresult" method="get">
														{% csrf_token %}
														<input type="hidden" name="rowid"  value="{{row.rowid}}">
														<input type="hidden" name="price"  value="{{row.firstclass}}">
														<input type="hidden" name="tax"  value="{{row.firsttax}}">
														<input type="hidden" name="action"  value="return">
														<input type="hidden" name="keyid"  value="{{row.searchkeyid}}">
														<input type="hidden" name="returnkey"  {% if returndata %} value="{{returndata}}"{%endif%}>
														<button type"submit" value="{{searchrow.searchid}}" name="return" >SELECT</button>
													</form>
													</div>
													{% else %}
													<div>
													<span class="btn btn-default">SELECT</span>
													</div>
													{%endif%}
													{% else %}
														<div class="col-xs-12 nopadding mvb10px na-ra">
															<h5> Not Available</h5>
														</div>
													{% endif %}
													
												</div>
												
											</div>
											
											<div class="col-sm-4 col-xs-12 nopr">
												<div class="col-xs-12 nopadding text-center">
													{% if row.cabintype3 and row.business %}
													<h5 class="econo">{{row.cabintype3}}</h5>
													<div class="col-xs-12 nopadding mvb10px na-ra">
														<p class="flight-rate">
															{% if row.datasource == "delta" %}
															{{row.business|add:minprice}} {%else%}{{row.business}} {%endif%} Miles
														</p>
														<p>+</p>
														<h6>${{row.businesstax}}</h6>
													</div>
													{% if action == 'depart' %}
													<div>
													<form action="getsearchresult" method="get">
														{% csrf_token %}
														<input type="hidden" name="price"  value="{{row.business}}">
														<input type="hidden" name="tax"  value="{{row.businesstax}}">
														<input type="hidden" name="action"  value="{{action}}">
														<input type="hidden" name="keyid"  value="{{row.searchkeyid}}">
														<input type="hidden" name="returnkey"  {% if returndata %} value="{{returndata}}"{%endif%}>
														<button type"submit" value="{{searchrow.searchid}}" name="return" >SELECT</button>
													</form>
													</div>
													{% else %}
													<div>
													<span class="btn btn-default">SELECT</span>
													</div>
													{%endif%}
													{% else %}
														<div class="col-xs-12 nopadding mvb10px na-ra">
															<h5> Not Available</h5>
														</div>
													{% endif %}
													
												</div>
											</div>
											
										</div>
									</div>
									<div class="col-xs-12 pop-hover">
											<a class="" role="button" data-toggle="collapse" href="#{{row.rowid}}" aria-expanded="false" aria-controls="collapseExample">SHOW DETAILS</a>
											<div class="collapse" id="{{row.rowid}}">
												<div class="well">
													<h2>DEPART</h2>
													<p>
														COMPANY FLIGHT (ECO)
													</p>
													<div class="table-responsive table-date-search">
														<table class="table">
															<tr>
																<td>{{row.departure}}</td>
																<td>{{searchdate}}</td>
																<td>{{row.origin}}</td>
															</tr>
															<tr>
																<td>{{row.arival}}</td>
																<td>{{searchdate}}</td>
																<td>{{row.destination}}</td>
															</tr>
														</table>
													</div>
													<a href="#">share</a>
												</div>
											</div>
										</div>
								</div>
								{%endfor %}
								{% endif %}
							</div>
							<div class="col-md-2 col-xs-12 nopadding"><img src="{% static 'flightsearch/img/ad.jpg' %}" class="img-responsive" alt="Responsive image">
							</div>
						</div>
					</div>
				</div>
			</div>
			<script type="text/javascript">
			$(function() {
				$('#departuredate').datepicker({
					minDate : 0
				});
				$('#return').datepicker({
					minDate : 0
				});
				$('#departMain').on('change', function() {
			    $('#returnMain').datepicker("option", "minDate", $('#departMain').datepicker('getDate'));
				});
			});
		</script>
			<!--

			<script>

			jQuery(window).load(function()
			{

			var $ = jQuery;

			$("#datatable").dataTable({
			"columns": [
			{ "data": "Flight No." },
			{ "data": "Source Station" },
			{ "data": "Departure Time" },
			{ "data": "Main Cabin" },
			{ "data": "First/Business" },
			{ "data": "Arival Time" },
			{ "data": "Destination Station" },

			]
			});
			/*
			$("#datatable tbody input[type=checkbox]").each(function(i, el)
			{
			var $this = $(el),
			$p = $this.closest('tr');

			$(el).on('change', function()
			{
			var is_checked = $this.is(':checked');

			$p[is_checked ? 'addClass' : 'removeClass']('highlight');
			});
			});

			// Replace Checboxes
			$(".pagination a").click(function(ev)
			{
			replaceCheckboxes();
			});*/

			});

			// Sample Function to add new row
			var giCount = 1;
			</script>
			<link rel="stylesheet" href="{% static 'flightsearch/datatables/responsive/css/datatables.responsive.css' %}">
			<script src="{% static 'flightsearch/js/vendor/jquery-1.11.2.min.js' %}"></script>
			<script src="{% static 'flightsearch/js/jquery.dataTables.min.js' %}"></script>
			<script src="{% static 'flightsearch/datatables/TableTools.min.js' %}"></script>
			<script src="{% static 'flightsearch/datatables/jquery.dataTables.columnFilter.js' %}"></script>
			<script src="{% static 'flightsearch/datatables/responsive/js/datatables.responsive.js' %}"></script>
			<script src="{% static 'flightsearch/datatables/lodash.min.js' %}"></script>
			<script src="{% static 'flightsearch/js/dataTables.bootstrap.js' %}"></script>
			-->
			{% include "flightsearch/footer.html" %}
			<script src="{% static 'flightsearch/js/vendor/bootstrap.min.js' %}"></script>
			
			<script>
			/*
			$('#return').click(function()
			{
				var keyid = $('#return').val();
				
				alert(keyid);
				$.ajax({
			        type: "POST",
			        url: "/search/",
			        data: "keyid="+ encodeURI(keyid)+ "&type="+ encodeURI("returntype")+ "&csrfmiddlewaretoken=" + encodeURI(CSRF_TOKEN),
			    	success: function(data){
			        console.log(data);
			        searchid = data;
			        redirecttosearchpage(searchid);
			       
			        
			    },
				
			   });
			 });
			function redirecttosearchpage(searchid){
			 	if(searchid != '')
			{
				//alert(searchid)  ;  
				$('#searchid').val(searchid);
				window.location.href = "getsearchresult?keyid="+ encodeURI(searchid) ;
			}
			} */
			</script>

			<script>
			var deptmintime ;
			var arivemintime; 
			var deptmaxtime;
			var arivemaxtime;
			
			function timeconversion(time)
			{
					var val = time;
					var hour;
					ampm = val.split(' ');
					mindepature = ampm[0].split(':');
					hour = mindepature[0];
					
					if($.trim(ampm[1]) != "p.m." && $.trim(ampm[1]) != "PM") 
					{
						
		
						if(parseInt(hour) > 11)
						{
							hour = 0;
						}	
					}
					else
					{
						
						hour = parseInt(hour)+12;
						
					}
					minute = mindepature[1];	
					deptmin = (hour*60);
					if(minute)
					{
						deptmin = parseInt(deptmin)+parseInt(minute);
					}
					
					return deptmin;
					
				
			}
			
				{%if timedata %}
				
					
					var dept = "{{ timedata.mindept }}";
					if(dept != "None")
					{
						deptmintime = timeconversion(dept);
					}
					else{
						deptmintime=0;
					}
					
					var arive = "{{ timedata.minarival }}";
					if(arive != "None")
					{
						arivemintime = timeconversion(arive);
					}
					else{
						arivemintime=0;
					}
					var maxdeparture = "{{ timedata.maxdept }}";
					if(maxdeparture != "None")
					{
						deptmaxtime = timeconversion(maxdeparture);
					}
					else{
						deptmaxtime=1439;
					}
					
					var maxarivaltime = "{{ timedata.maxarival }}";
					
					if(maxarivaltime != "None")
					{
						
						arivemaxtime = timeconversion(maxarivaltime);
						
					}
					else{
						arivemaxtime=1439;
					}
					
					
				{% endif%}
			
			
			
			 
			 
			
				/*************************** SLIDER DECTION  ******************************/
				$("#depart").slider({
					range : true,
					min : 0,
					max : 1439,
					values : [deptmintime, deptmaxtime],
					slide : slideTime1
				});

				function slideTime1(event, ui) {
					var val0 = $("#depart").slider("values", 0),
						val1 = $("#depart").slider("values", 1),
					    minutes0 = parseInt(val0 % 60, 10),
					    hours0 = parseInt(val0 / 60 % 24, 10),
					    minutes1 = parseInt(val1 % 60, 10),
					    hours1 = parseInt(val1 / 60 % 24, 10);
						start = getTime(hours0, minutes0);
						end = getTime(hours1, minutes1);
						$('#depaturemin').val(start);
						$('#depaturemax').val(end);
						$("#time").text(start + ' - ' + end);
				}

				$("#arive").slider({
					range : true,
					min : 0,
					max : 1439,
					values : [arivemintime, arivemaxtime],
					slide : slideTime
				});

				function slideTime(event, ui) {
					var val0 = $("#arive").slider("values", 0),
					    val1 = $("#arive").slider("values", 1),
					    minutes0 = parseInt(val0 % 60, 10),
					    hours0 = parseInt(val0 / 60 % 24, 10),
					    minutes1 = parseInt(val1 % 60, 10),
					    hours1 = parseInt(val1 / 60 % 24, 10);
						startTime = getTime(hours0, minutes0);
						$('#arivalmin').val(startTime);
						endTime = getTime(hours1, minutes1);
						$('#arivalmax').val(endTime);
						$("#arivaltime").text(startTime + ' - ' + endTime);
				}

				function getTime(hours, minutes) {
					var time = null;
					minutes = minutes + "";
					if (hours < 12) {
						time = "AM";
					} else {
						time = "PM";
					}
					if (hours == 0) {
						hours = 12;
					}
					if (hours > 12) {
						hours = hours - 12;
					}
					if (minutes.length == 1) {
						minutes = "0" + minutes;
					}
					return hours + ":" + minutes + " " + time;
				}

				slideTime();
				slideTime1();
			</script>
		</body>

</html>

