{% extends "flightsearch/base.html" %}
{% load staticfiles %}
{% load customfilter %}
{% load humanize %}

{% block content %}

<style>
.add {
    margin-left: -6px;
}
</style>
<div class="main-holder">
    <div class="col-xs-12 nopadding">
        <div class="jumbotron">
            <div class="container-fluid">
                <div class="col-md-12 col-xs-12 nopadding">
                    <div class="col-md-2 col-xs-12 nopadding ">
                        <div class="col-xs-12 nopadding">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" {% if progress_value %} style="width:{{progress_value}}px" {% else%}style="width:5%" {%endif%} id="progressbar">
                                    Loading
                                </div>
                            </div>
                        </div>
                        {%if pointlist%}
                        <div class="col-xs-12 col-md-12 nopadding">
                            <a class="account_balance" role="button" data-toggle="collapse" href="#account-balance" aria-expanded="false" aria-controls="pricecalender">
                                <div class="col-xs-12 nopaddig form-side-2">
                                    <p class="pull-left">
                                        VIEW ACCOUNT BALANCES
                                    </p>
                                    <p class="pull-right show-filter visible-xs">
                                        <span class="glyphicon glyphicon-edit visible-xs"></span>
                                    </p>
                                </div>
                            </a>
                            <div class="col-xs-12 nopadding form-side collapse" id="account-balance">
                                <dl>
                                    {% for point in pointlist%}
                                    <div class="cutom-ui-mil">
                                        <dt class="dl-horizontal" style="text-transform: uppercase;">
                                            {% if point.3  ==  'virgin'%} {{point.3}} Atlantic Airline: {%else%} {{point.3}} Airline: {%endif%}
                                        </dt>
                                        <dd class="text-right">
                                            {{point.2}} MILES
                                        </dd>
                                    </div>
                                    {%endfor%}
                                </dl>
                            </div>
                        </div>
                        {%endif%}
                        <div class="filters-holder mvb10px col-xs-12 nopadding ">
                            <div class="col-xs-12 nopadding visible-xs filter-collapse form-side">
                                <p class="pull-left">
                                    Filters
                                </p>
                                <p class="pull-right show-filter">
                                    <span class="glyphicon glyphicon-th-large"></span>
                                </p>
                            </div>
                            <form action="getsearchresult?keyid={{request.GET.keyid}}&passenger={{request.GET.passenger}}&cabin={{request.GET.cabin}}
                            {% if request.GET.returnkey%}&returnkey={{request.GET.returnkey}}{% endif %}{% if request.GET.multicity%}&multicity={{request.GET.multicity}}{% endif %}{% if request.GET.searchtype%}&searchtype={{request.GET.searchtype}}{%endif%}" method="post">
                                <div class="container nopadding">
                                    {% csrf_token %} {% if selectedrow %}
                                    <input type="hidden" name="rowid" id="rowid" value="{{selectedrow.rowid}}" /> {% endif %} {% if search %} {% for searchrow in search %}
                                    <input type="hidden" name="progress_value" id="progress_hidden_val" value="">
                                    <input type="hidden" name="passenger" id="traveller" value="">
                                    <input type="hidden" name="cabin" {% if cabin %} value="{{cabin}}" {% else %}value="{{request.GET.cabin}}" {% endif%}>
                                    <input type="hidden" name="action" {% if 'action' in request.GET and request.GET.action  ==  'depart' %}value="{{request.GET.action}}" {% else%} value="{{action}}" {%endif%}>
                                    <input type="hidden" name="tax" id="fltrtax" {% if request.GET.tax %} value="{{request.GET.tax}}" {%else%} value="{{tax}}" {% endif%}>
                                    <input type="hidden" name="price" id="fltrprice" {% if request.GET.price %} value="{{request.GET.price}}" {%else%} value="{{minprice}}" {% endif%}>
                                    <input type="hidden" name="searchkeyval" value="{{ searchrow.searchid }}" id="searchkey" /> {% if returndata %}
                                    <input type="hidden" name="returnkey" value="{{returndata}}" id="returnkey" /> {%endif%} {%endfor %} {% endif %}
                                    <input type="hidden" name="deltamin" value="{{deltaminval}}" />
                                    <input type="hidden" name="deltatax" value="{{deltatax}}" />
                                    <input type="hidden" name="unitedmin" value="{{unitedminval}}" />
                                    <input type="hidden" name="unitedtax" value="{{unitedtax}}" />
                                    <input type="hidden" name="deltacabin_name" id="" value="{{deltacabin_name}}" />
                                    <input type="hidden" name="unitedcabin_name" id="" value="{{unitedcabin_name}}" />
                                </div>
                                <div class="col-md-12 col-xs-12 nopadding form-side">
                                    <div class="priceRangeInfo">
                                        <p>Miles</p>
                                        <div class="slider slider-blue mvt15px" data-postfix=" $" data-min="0" data-max="2000" data-min-val="400" data-max-val="1400" data-fill="#sample-field-2" id="miles_slider"></div>
                                        <span id="miles_value"></span>
                                        <input type="hidden" name="minPriceMile" id="minPriceMile" {% if filterkey.minpricemile and filterkey.minpricemile > 0 %} value="{{filterkey.minpricemile}}" {%endif%}/>
                                        <input type="hidden" name="maxPriceMile" id="maxPriceMile" value="" />
                                    </div>
                                </div>
                                <div class="col-md-12 col-xs-12 nopadding form-side">
                                    <div class="priceRangeInfo">
                                        DEPARTURE TIME
                                        <div class="slider slider-blue mvt15px" data-postfix=" $" data-min="0" data-max="2000" data-min-val="400" data-max-val="1400" data-fill="#sample-field-2" id="depart"></div>
                                        <span id="time"></span>
                                        <input type="hidden" name="depaturemin" id="depaturemin" value="" />
                                        <input type="hidden" name="depaturemax" id="depaturemax" value="" />
                                    </div>
                                    <div class="priceRangeInfo mvt15px">
                                        ARRIVAL TIME
                                        <div class="slider slider-blue mvt15px" data-postfix=" $" data-min="0" data-max="2000" data-min-val="400" data-max-val="1400" data-fill="#sample-field-2" id="arive"></div>
                                        <span id="arivaltime"></span>
                                    </div>
                                    <input type="hidden" name="arivalmin" id="arivalmin" value="" />
                                    <input type="hidden" name="arivalmax" id="arivalmax" value="" />
                                </div>
                                <div class="col-md-12 col-xs-12 nopadding form-side">
                                    <p> FARE CODES</p>
                                    <div class="col-md-10 col-xs-10 nopadding" id="add_fare_code">
                                    </div>
                                </div>
                                <div class="col-md-12 col-xs-12 nopadding form-side">
                                    <p>
                                        NUMBER OF STOPS
                                    </p>
                                    <div class="col-md-10 col-xs-10 nopadding">
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' id="selectallstop">
                                                <span></span> SELECT ALL </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-stoppage" name="stoppage" value="NONSTOP" {% for row in filterkey.stoppage %} {% if row == 'NONSTOP' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> NONSTOP </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-stoppage" name="stoppage" value="1 STOP" {% for row in filterkey.stoppage %} {% if row == '1 STOP' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> 1 STOP </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-stoppage" name="stoppage" value="2 STOPS" {% for row in filterkey.stoppage %} {% if row == '2 STOPS' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> 2+ STOPS </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 col-xs-12 nopadding form-side">
                                    <p>
                                        AIRLINES
                                    </p>
                                    <div class="col-md-11 col-xs-11 nopadding">
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' id='selectairline' />
                                                <span></span> SELECT ALL </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="delta" {% for row in filterkey.datasource %} {% if row == 'delta' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> DELTA AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="jetblue" {% for row in filterkey.datasource %} {% if row == 'jetblue' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> JETBLUE AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="united" {% for row in filterkey.datasource %} {% if row == 'united' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> UNITED AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="s7" {% for row in filterkey.datasource %} {% if row == 's7' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> S7 AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="airchina" {% for row in filterkey.datasource %} {% if row == 'airchina' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> AIRCHINA AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="etihad" {% for row in filterkey.datasource %} {% if row == 'etihad' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> ETIHAD AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="virgin_atlantic" {% for row in filterkey.datasource %} {% if row == 'virgin_atlantic' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> VIRGIN ATLANTIC AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="Virgin America" {% for row in filterkey.datasource %} {% if row == 'Virgin America' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> VIRGIN AMERICA AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="Virgin Australia" {% for row in filterkey.datasource %} {% if row == 'Virgin Australia' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> VIRGIN AUSTRALIA AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="american airlines" {% for row in filterkey.datasource %} {% if row == 'american airlines' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> AMERICAN AIRLINES </label>
                                        </div>
                                        <div class="checkbox">
                                            <label>
                                                <input type='checkbox' class="chk-airlines" name="airlines" value="aeroflot" {% for row in filterkey.datasource %} {% if row == 'aeroflot' %} checked="checked" {% endif %}{%endfor %}>
                                                <span></span> AEROFLOT AIRLINES </label>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="search" value="search">
                                <div class="col-md-12 col-xs-12 nopadding">
                                    <input type="submit" value="FILTER" class="btn  btn-pexSearch filter-serch-btn">
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-8 col-xs-12 xs-nopadding">
                        {% if multisearch and 'multicity' in request.GET %}
                        <div class="nopaddig">
                            <h4 class "alert-danger" id="nodata-msg"></h4>
                        </div>
                        <div class="col-xs-12 mvb10px nopadding search-name">
                            <div class="col-md-11 nopadding ">
                                {% for searchparam in multisearch %}
                                <div class="data-search-area">
                                    <p>
                                        {{searchparam.source}}
                                    </p>
                                    <span>{{searchparam.traveldate|date:"d M"}}</span>
                                </div>
                                <h4 class="for-desktop-view arrow-size"><img src="/static/flightsearch/img/summary-arrow.png"  class="img-responsive"></h4>
                                <div class="data-search-area">
                                    <p>
                                        {{searchparam.destination}}
                                    </p>
                                    <span> .</span>
                                </div>
                                {% endfor %}
                                <div class="main-plc-name">
                                    <div class="name-area">
                                        {% if request.GET.cabin  ==  "maincabin"%}
                                        <p>
                                            Economy
                                        </p>
                                        {%else%}
                                        <p>
                                            {{request.GET.cabin|title}}
                                        </p>
                                        {% endif %}
                                        <span>cabin</span>
                                    </div>
                                    <div class="name-area">
                                        <p>
                                            {{request.GET.passenger}}
                                        </p>
                                        <span>Traveller</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1 nopadding">
                                <div class="form-group flight-search-xswd">
                                    <a href="flights?multicitykeys={{request.GET.multicity}}&cabin={{request.GET.cabin}}&passenger={{request.GET.passenger}}">
                                        <button class="form_val btn  btn-pexSearch xs-fw" tabindex="13">
                                            Change
                                        </button>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %} {% if search and 'multicity' not in request.GET%}
                        <div class="col-xs-12 mvb10px nopadding">
                            <div class="nopaddig">
                                <h4 class "alert-danger" id="nodata-msg"></h4>
                            </div>
                            <div class="col-xs-12 nopaddig visible-xs form-side">
                                <p class="pull-left">
                                    Search Flights
                                </p>
                                <p class="pull-right flight-search-show">
                                    <span class="glyphicon glyphicon-search"></span>
                                </p>
                            </div>
                            <div class="col-xs-12 nopadding xs-collapse flight-search-panel mvb10px">
                                <form class="form-inline" method="post" action="">
                                    {% csrf_token %} {% for searchrow in search %}
                                    <div class="form-group date-wd flight-search-xswd xs-pr5">
                                        <label class="sr-only" for="exampleInputEmail3">Source</label>
                                        <input type="text" tabindex="1" id="from" class="form_val form-control" value="{{searchrow.source}}">
                                        <input type="hidden" id="fromid" name="fromMain" value="{{searchrow.origin_airport_id}}">
                                    </div>
                                    <div class="form-group">
                                        <h4 class="for-desktop-view arrow-size">&#8594;</h4>
                                    </div>
                                    <div class="form-group date-wd flight-search-xswd">
                                        <label class="sr-only" for="exampleInputPassword3">Destination</label>
                                        <input type="text" tabindex="2" id="to" class="form_val form-control" value="{{searchrow.destination}}">
                                        <input type="hidden" id="toid" name="toMain" value="{{searchrow.destination_airport_id}}">
                                    </div>
                                    <div class="form-group date-wd flight-search-xswd xs-pr5">
                                        <label class="sr-only" for="exampleInputPassword3">Departure</label>
                                        <div class="inner-addon left-addon date" id="dp1">
                                            <i class="glyphicon glyphicon-calendar"></i>
                                            <input type="text" tabindex="3" class="form_val form-control curson" value="{{searchrow.traveldate|date:" m/d/Y "}}" id="departuredate" name="deptdate">
                                        </div>
                                    </div>
                                    {%endfor %} {%if returndate %}
                                    <div class="form-group date-wd flight-search-xswd">
                                        <label class="sr-only" for="exampleInputPassword3">return</label>
                                        <div class="inner-addon left-addon date" id="dp2">
                                            <i class="glyphicon glyphicon-calendar"></i>
                                            <input type="text" tabindex="4" class="form_val form-control curson" value="{{returndate.0|date:" m/d/Y "}}" id="return" name="returndate">
                                        </div>
                                    </div>
                                    {%endif%}
                                    <div class="form-group opentab flight-search-xswd" id="cabintab" tabindex="5">
                                        <div class="form-group travelers-dpdn-details nomr noml nomb" class="ui-widget">
                                            <div class="dropdown travelers-holder form-control">
                                                <span class="curson" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="travelar">1 adult, Economy</span> <span class="caret"></span></span>
                                                <div class="travelers-down-menu dropdown-menu" aria-labelledby="dropdownMenu1">
                                                    <div class="col-xs-12 down-menu-block">
                                                        <span class="col-xs-4 nopadding">Class</span>
                                                        <span class="col-xs-8 text-right nopr">
                                                            <select class="custom-field-control notclose curson" id="cabintype" name="cabintype" tabindex="6">
                                                                <option class="cabin" value="maincabin" {% if request.GET.cabin  ==  "maincabin" or cabin  ==  "maincabin" %} selected="selected" {% endif %}>Economy</option>
                                                                <option class="cabin" value="firstclass" {% if request.GET.cabin  ==  "firstclass" or cabin  ==  "firstclass" %} selected="selected" {% endif %}>Business</option>
                                                                <option  class="cabin" value="business" {% if request.GET.cabin  ==  "business" or cabin  ==  "business" %} selected="selected" {% endif %}>First</option>
                                                            </select></span>
                                                    </div>
                                                    <div class="col-xs-12 alert alert-warning"></div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Adults</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="1" id="adults" tabindex="7">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">18+</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Seniors</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="0" id="senior" tabindex="8">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">65+</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Youths</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="0" id="youth" tabindex="9">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">12-17</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Children</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="0" id="children" tabindex="10">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">2-11</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Seat infants</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="0" id="seatinfants" tabindex="11">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">under 2</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <p>
                                                            <span class="col-xs-4 nopadding">Lap infants</span>
                                                            <span class="col-xs-5 text-right nopadding"> <span class="btn btn-default btn-xs minus"><span class="glyphicon glyphicon-minus"></span></span>
                                                            <input type="text" class="field-width custom-field-control numberHolder qty" value="0" id="lapinfants" tabindex="12">
                                                            <span class="btn btn-default btn-xs add"><span class="glyphicon glyphicon-plus"></span></span>
                                                            </span>
                                                            <span class="col-xs-3 nopr">under 2</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xs-12 down-menu-block">
                                                        <span class="btn btn-pexSearch" id="apply_traveler">Apply</span>
                                                    </div>
                                                    <input type="hidden" id="passenger" name="passenger" value="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group flight-search-xswd xs-pl5">
                                        <button id="changebtnid" class="form_val btn  btn-pexSearch xs-fw" tabindex="13">
                                            Change
                                        </button>
                                    </div>
                                </form>
                                <!--
                                <h4>{% if action  ==  'return' %}Return : {% endif %}{{searchrow.source}} &#10230; {{searchrow.destination}} </h4>
                                <h4> {{searchrow.traveldate}}<!--<input type="text" id="datepicker" name="date" value="{{searchdate}}"></h4>-->
                            </div>
                        </div>
                        {% endif %}
                        <div class="col-xs-12 nopadding">
                            <div class="col-sm-6 col-xs-12 nopadding">
                                <a class="price-calender" role="button" data-toggle="collapse" href="#pricecalender" aria-expanded="false" aria-controls="pricecalender"> View Price Matrix</a>
                                <div class="collapse" id="pricecalender">
                                    <span class="mvt10px"> {{search.0.source}} to {{search.0.destination}}{% if returndate %}: Round Trip{%else%}:  One Way{% endif %}</span>
                                    <div class="well custom-well text-center">
                                        <input type="hidden" id="fix_min_price" />
                                        <input type="hidden" id="fix_max_price" />
                                        <section id="">
                                            <div class="table-responsive" id="price_matrix" style="margin:0;">
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                            <!--  price matrix -->
                            {% if 'searchtype' in request.GET and request.GET.searchtype  ==  'flexibledate'%}
                            <div class="col-sm-6 col-xs-12 nopadding">
                                <a class="price-calendar pull-right" role="button" data-toggle="collapse" href="#flexcalendar" aria-expanded="false" aria-controls="flexcalendar"> Award Availabilty Calendar</a>
                                <div class="col-xs-12 nopadding collapse" id="flexcalendar">
                                    <div class="col-xs-12 nopadding well custom-well text-center">
                                        <p class="custom_p text-left">
                                            <span class="box color-grey-1"></span> Saver Award Economy
                                        </p>
                                        <p class="custom_p text-left">
                                            <span class="box color-blue-1"></span> Saver Award Business/First
                                        </p>
                                        <p class="custom_p text-left">
                                            <span class="box color-red-1"></span> Saver Award Economy & Business/First
                                        </p>
                                        <p class="custom_p text-left">
                                            <span class="box"></span> Standard Award may be available
                                        </p>
                                        <section class="col-xs-12 nopadding" id="">
                                            <div class="col-xs-12 nopadding table-responsive" id="calendarmatix">
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                            <!-- Flexible  date calendar-->
                            {% endif%}
                        </div>
                        {% if selectedrow %}
                        <div class="col-xs-12 selected-flights bgclr">
                            <div class="col-xs-12 nopadding visible-xs visible-sm">
                                <div class="col-sm-3 col-xs-5 text-left nopl ">
                                    {% if selectedrow.datasource  ==  "united" %}
                                    <img src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "s7" %}
                                    <img src="{% static 'flightsearch/img/s7Logo.svg' %}" class="img-responsive" alt="Responsive image" style="background-color: white !important;">{% endif %} {% if selectedrow.datasource  ==  "airchina" %}
                                    <img src="{% static 'flightsearch/img/airchinaLogo.gif' %}" class="img-responsive" alt="Responsive image" style="background-color: white !important;">{% endif %} {% if selectedrow.datasource  ==  "virgin_atlantic" %}
                                    <img src="{% static 'flightsearch/img/virgin.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "delta" %}
                                    <img src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "jetblue" %}
                                    <img src="{% static 'flightsearch/img/jetblue.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "etihad" %}
                                    <img src="{% static 'flightsearch/img/etihad.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "Virgin America" %}
                                    <img src="{% static 'flightsearch/img/va.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "Virgin Australia" %}
                                    <img src="{% static 'flightsearch/img/VAUS.png' %}" class="img-responsive" alt="Responsive image">{% endif %}
                                </div>
                                <div class="col-sm-9 col-xs-7 nopr">
                                    <p class="flight-name">
                                        {{selectedrow.flighno}}
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-5 col-xs-12 nopadding">
                                <div class="col-xs-12 nopadding">
                                    <div class="col-xs-12 nopadding">
                                        <div class="col-md-12 col-sm-9 col-xs-9 nopadding">
                                            <div class="arrivel col-md-5 col-xs-5 col-sm-5 nopadding" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="departureAirport">
                                                    {{selectedrow.origin}}
                                                </p>
                                                <p itemprop="departureTime">
                                                    {{selectedrow.departure}}
                                                </p>
                                            </div>
                                            <div class="arrow-div col-md-2 col-xs-2 col-sm-2 nopadding">
                                                &#8594;
                                            </div>
                                            <div class="arrivel-2 col-md-5 col-xs-5 col-sm-5 nopadding text-right" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="arrivalAirport">
                                                    {{selectedrow.destination}}
                                                </p>
                                                <p itemprop="arrivalTime">
                                                    {{selectedrow.arival}}
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-sm-3 col-xs-3 nopr visible-sm visible-xs text-center">
                                            <div class="col-xs-12 nopadding">
                                                <p class="stops-dur">
                                                    <span>{{selectedrow.stoppage}}</span><span>{{row.duration}}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-xs-6 text-left xs-nopadding hidden-xs hidden-sm xs-margin-20">
                                {% if selectedrow.datasource  ==  "united" %}
                                <img src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "s7" %}
                                <img src="{% static 'flightsearch/img/s7Logo.svg' %}" class="img-responsive" style="background-color: white !important;" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "airchina" %}
                                <img src="{% static 'flightsearch/img/airchinaLogo.gif' %}" class="img-responsive" style="background-color: white !important;" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "delta" %}
                                <img src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "etihad" %}
                                <img src="{% static 'flightsearch/img/etihad.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "jetblue" %}
                                <img src="{% static 'flightsearch/img/jetblue.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "virgin_atlantic" %}
                                <img src="{% static 'flightsearch/img/virgin.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "Virgin America" %}
                                <img src="{% static 'flightsearch/img/va.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "american airlines" %}
                                <img src="{% static 'flightsearch/img/aa.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if selectedrow.datasource  ==  "Virgin Australia" %}
                                <img itemprop="logo" src="{% static 'flightsearch/img/VAUS.png' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if selectedrow.datasource  ==  "aeroflot" %}
                                <img itemprop="logo" src="{% static 'flightsearch/img/aeroflot.png' %}" class="img-responsive" alt="Responsive image"> {% endif %}
                                <h5>OUTBOUND</h5>
                            </div>
                            <div class="col-sm-5 col-xs-6 col-xs-12 nopadding hidden-sm hidden-xs for-mobile-view text-right xs-margin-20">
                                <p class="flight-name">
                                    {{selectedrow.flighno}}
                                </p>
                                <p class="stops-dur">
                                    <span>{{selectedrow.stoppage}}</span><span>{{selectedrow.duration}}</span>
                                </p>
                            </div>
                            <div class="col-md-5 col-xs-12 nopadding">
                                <div class="col-xs-12 nopadding">
                                    <div class="col-md-5 col-sm-5 col-xs-12 nopadding hidden-sm hidden-xs for-desktop-view">
                                        <p class="flight-name">
                                            {{selectedrow.flighno}}
                                        </p>
                                        <p class="stops-dur">
                                            <span>{{selectedrow.stoppage}}</span><span>{{selectedrow.duration}}</span>
                                        </p>
                                    </div>
                                    <div class="col-md-7 col-sm-12 col-xs-12 nopadding hidden-xs hidden-sm">
                                        <div class="col-xs-12 nopadding text-center">
                                            {% if request.GET.cabin  ==  'maincabin' %}
                                            <div class="col-xs-12 nopadding na-ra">
                                                <p class="flight-rate">
                                                    {{selectedrow.maincabin|intcomma}} Miles + <span>${{selectedrow.maintax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            <h5 class="econom">{{selectedrow.cabintype1}}</h5> {% endif %} {% if request.GET.cabin  ==  'firstclass' %}
                                            <div class="col-xs-12 nopadding na-ra">
                                                <p class="flight-rate">
                                                    {{selectedrow.firstclass|intcomma}} Miles + <span>${{selectedrow.firsttax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            <h5 class="econom"> {{selectedrow.cabintype2}} </h5> {% endif %} {% if request.GET.cabin  ==  'business' %}
                                            <div class="col-xs-12 nopadding na-ra">
                                                <p class="flight-rate">
                                                    {{selectedrow.business|intcomma}} Miles + <span>${{selectedrow.businesstax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            <h5 class="econom"> {{selectedrow.cabintype3}} </h5> {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-xs-12 nopadding mvt10px visible-sm visible-xs">
                                        <div class="col-xs-12 nopadding text-center">
                                            {% if request.GET.cabin  ==  'maincabin' %}
                                            <div class="col-xs-12 nopadding na-ra text-right">
                                                <h5 class="econo pull-left nopl nomt"> {{selectedrow.cabintype1}} </h5>
                                                <p class="flight-rate pull-right">
                                                    {{selectedrow.maincabin|intcomma}} Miles + <span>${{selectedrow.maintax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            {% endif %} {% if request.GET.cabin  ==  'firstclass' %}
                                            <div class="col-xs-6 nopadding na-ra text-right">
                                                <h5 class="econo pull-left nopl nomt"> {{selectedrow.cabintype2}} </h5>
                                                <p class="flight-rate pull-right">
                                                    {{selectedrow.firstclass|intcomma}} Miles + <span>${{selectedrow.firsttax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            {% endif %} {% if request.GET.cabin  ==  'business' %}
                                            <div class="col-xs-6 nopadding na-ra text-right">
                                                <h5 class="econo pull-left nopl nomt"> {{selectedrow.cabintype3}} </h5>
                                                <p class="flight-rate pull-right">
                                                    {{selectedrow.business|intcomma}} Miles + <span>${{selectedrow.businesstax|floatformat:2}}</span>
                                                </p>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 nopadding pop-hover xs-nopadding">
                                <a class="show-details" role="button" data-toggle="collapse" href="#{{selectedrow.rowid}}" aria-expanded="false" aria-controls="collapseExample">SHOW DETAILS</a>
                                <div class="collapse" id="{{selectedrow.rowid}}">
                                    <div class="well">
                                        <h2>DEPART</h2>
                                        <p>
                                            {{selectedrow.datasource|title}} | {{selectedrow.flighno}} ( {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin'%} {{selectedrow.cabintype1}} {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %} {{selectedrow.cabintype2}} {% else%}{{selectedrow.cabintype3}} {% endif %})
                                        </p>
                                        <div class="table-responsive table-date-search">
                                            <table class="table">
                                                {% with selectedrow.departdetails|split:'@' as mylist%} {% with selectedrow.arivedetails|split:'@' as mylist1%} {% with selectedrow.planedetails|split:'@' as mylist2%} {% with selectedrow.operatedby|split:'@' as mylist3%}
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.0}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.0}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td itemprop="flightNumber"><b>Flight:</b></td>
                                                    <td>{{mylist2.0}}</td>
                                                </tr>
                                                {% if mylist3.0 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.0}}</td>
                                                </tr>
                                                {% endif %} {% if selectedrow.stoppage  ==  '1 STOP' or selectedrow.stoppage  ==  '2 STOPS' or selectedrow.stoppage  ==  '3 STOPS' or selectedrow.stoppage  ==  '4 STOPS'%}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.1}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.1}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.1}}</td>
                                                </tr>
                                                {% if mylist3.1 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.1}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if selectedrow.stoppage  ==  '2 STOPS' or selectedrow.stoppage  ==  '3 STOPS' or selectedrow.stoppage  ==  '4 STOPS'%}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.2}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.2}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.2}}</td>
                                                </tr>
                                                {% if mylist3.2 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.2}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if selectedrow.stoppage  ==  '3 STOPS' or selectedrow.stoppage  ==  '4 STOPS' %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.3}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.3}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.3}}</td>
                                                </tr>
                                                {% if mylist3.3 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.3}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if selectedrow.stoppage  ==  '4 STOPS' %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.4}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.4}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.4}}</td>
                                                </tr>
                                                {% if mylist3.3 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.4}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% endwith %} {% endwith %} {% endwith %} {% endwith %}
                                            </table>
                                        </div>
                                        <a href="#" data-toggle="modal" class="share" data-target="#share-modal" id="{{selectedrow.rowid}}">share</a>
                                        <input type="hidden" value="Anyone want to meet me in  {{search.0.destination}}? I found a great flight for Miles {{selectedrow.maincabin|intcomma}} on Pex." class="{{selectedrow.finalprice|intcomma}}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %} {% if data %} {% for row in data %}
                        <div class="col-md-12 col-xs-12 centr-info responsive-color-img contentdiv">
                            <div class="col-sm-3 col-xs-5 visible-xs visible-sm nopl">
                                <div class="col-xs-12 nopadding text-center" itemscope itemtype="http://schema.org/Airline">
                                    {% if row.datasource  ==  "united" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "s7" %}
                                    <img src="{% static 'flightsearch/img/s7Logo.svg' %}" class="img-responsive" alt="Responsive image" style="background-color: white !important;">{% endif %} {% if row.datasource  ==  "airchina" %}
                                    <img src="{% static 'flightsearch/img/airchinaLogo.gif' %}" class="img-responsive" style="background-color: white !important;" alt="Responsive image">{% endif %} {% if row.datasource  ==  "virgin_atlantic" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/virgin.png' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "american airlines" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/aa.jpg' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "Virgin America" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/va.jpg' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "delta" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "etihad" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/etihad.jpg' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "jetblue" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/jetblue.jpg' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "Virgin Australia" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/VAUS.png' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "aeroflot" %}
                                    <img itemprop="logo" src="{% static 'flightsearch/img/aeroflot.png' %}" class="img-responsive" alt="Responsive image"> {% endif %}
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-9 col-xs-7 nopadding" itemscope itemtype="http://schema.org/Flight">
                                <p class="flight-name" itemprop="flightNumber">
                                    {{row.flighno}}
                                    <!--FIRST FLIGHT OPTION RESULT-->
                                </p>
                            </div>
                            <div class="col-md-5 col-xs-12 nopadding hidden-xs hidden-sm">
                                <div class="col-sm-8 col-sm-8 col-xs-12 nopl">
                                    <div class="col-md-12 col-xs-12 nopadding">
                                        <div class="col-xs-12 nopadding xs-margin-25px">
                                            <!-- new code  -->
                                            <div class="col-xs-12 nopadding mvb10px na-ra" itemscope itemtype="http://schema.org/FlightReservation">
                                                <p class="flight-rate" itemprop="totalPrice">
                                                    {{row.finalprice|intcomma}} Miles +<span>${{row.totaltaxes|floatformat:2}}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-4 col-xs-12 nopl">
                                    <div class="col-xs-12 nopadding text-center mvb10px" itemscope itemtype="http://schema.org/Airline">
                                        {% if row.datasource  ==  "united" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/unitedLogo.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "s7" %}
                                        <img src="{% static 'flightsearch/img/s7Logo.svg' %}" class="img-responsive" alt="Responsive image" style="background-color: white !important;">{% endif %} {% if row.datasource  ==  "airchina" %}
                                        <img src="{% static 'flightsearch/img/airchinaLogo.gif' %}" class="img-responsive" alt="Responsive image" style="background-color: white !important;">{% endif %} {% if row.datasource  ==  "delta" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/deltaLogo.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "etihad" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/etihad.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "Virgin America" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/va.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "american airlines" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/aa.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "virgin_atlantic" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/virgin.png' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "jetblue" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/jetblue.jpg' %}" class="img-responsive" alt="Responsive image">{% endif %} {% if row.datasource  ==  "Virgin Australia" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/VAUS.png' %}" class="img-responsive" alt="Responsive image"> {% endif %} {% if row.datasource  ==  "aeroflot" %}
                                        <img itemprop="logo" src="{% static 'flightsearch/img/aeroflot.png' %}" class="img-responsive" alt="Responsive image"> {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-7 col-xs-12 nopadding">
                                {% if multicity %} {% for i in recordlen %} {% with row.origin|lookup:i as sources %}
                                <div class="col-xs-12 nopadding flight-div-repeat">
                                    <div class="col-md-8 col-sm-8 col-xs-12 nopadding">
                                        <div class="col-xs-12 nopadding">
                                            <div class="arrivel col-sm-5 nopadding col-xs-4" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="departureAirport">
                                                    {{sources.origin}}
                                                </p>
                                                <p>
                                                    <time itemprop="departureTime">
                                                        {{sources.departure}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="arrow-div col-sm-2 col-xs-1 text-center nopadding">
                                                &#8594;
                                            </div>
                                            <div class="arrivel-2 col-sm-4 nopadding text-right col-xs-4 xs-text-center" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="arrivalAirport">
                                                    {{sources.destination}}
                                                </p>
                                                <p>
                                                    <time itemprop="arrivalTime">
                                                        {{sources.arival}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="col-xs-3 nopadding visible-xs text-right">
                                                <div class="col-xs-12 nopadding non-stop text-right">
                                                    <p>
                                                        {{sources.stoppage}}
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                    <p itemprop="estimatedFlightDuration">
                                                        {{sources.duration}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        {% if returndate  ==  '' and multicity  ==  '' %}
                                        <div class="col-xs-12 nopadding mvt10px for-mobile-view">
                                            <!-- main data only mobile -->
                                            <div class="col-xs-12 nopadding text-center custome-edit-block">
                                                <div class="col-xs-12 nopadding mvb10px na-ra">
                                                    <h5 class="econo edit-width-econo"> {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' %}
                                                    {{row.cabintype1}}
                                                    {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %}
                                                    {{row.cabintype2}}
                                                    {% else %}
                                                    {% if request.GET.cabin  ==  'business' or cabin  ==  'business' %}
                                                    {{row.cabintype3}}
                                                    {% endif %}
                                                    {% endif %} </h5>
                                                    <div class="right-data-responsive" itemscope itemtype="http://schema.org/FlightReservation">
                                                        <p class="flight-rate" itemprop="totalPrice">
                                                            {{row.finalprice|intcomma}} Miles +<span>${{row.totaltaxes|floatformat:2}}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-4 col-sm-4 col-xs-12 text-center nopr hidden-xs">
                                        <div class="col-xs-12 nopadding non-stop">
                                            <p>
                                                {{sources.stoppage}}
                                            </p>
                                            <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="estimatedFlightDuration">
                                                    {{sources.duration}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endwith %} {% endfor %} {% if multicity %}
                                <div class="col-xs-12 nopadding mvt10px for-mobile-view">
                                    <!-- main data only mobile -->
                                    <div class="col-xs-12 nopadding text-center custome-edit-block">
                                        <div class="col-xs-12 nopadding mvb10px na-ra">
                                            <h5 class="econo edit-width-econo"> {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' %}
                                            {{row.cabintype1}}
                                            {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %}
                                            {{row.cabintype2}}
                                            {% else %}
                                            {% if request.GET.cabin  ==  'business' or cabin  ==  'business' %}
                                            {{row.cabintype3}}
                                            {% endif %}
                                            {% endif %} </h5>
                                            <div class="right-data-responsive" itemscope itemtype="http://schema.org/FlightReservation">
                                                <p class="flight-rate" itemprop="totalPrice">
                                                    {{row.finalprice|intcomma}} Miles +<span>${{row.totaltaxes|floatformat:2}}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif%} {% else %}
                                <div class="col-xs-12 nopadding flight-div-repeat">
                                    <div class="col-md-8 col-sm-8 col-xs-12 nopadding">
                                        <div class="col-xs-12 nopadding">
                                            <div class="arrivel col-sm-5 nopadding col-xs-4" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="departureAirport">
                                                    {{row.origin}}
                                                </p>
                                                <p>
                                                    <time itemprop="departureTime">
                                                        {{row.departure}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="arrow-div col-sm-2 col-xs-1 text-center nopadding">
                                                &#8594;
                                            </div>
                                            <div class="arrivel-2 col-sm-4 nopadding text-right col-xs-4 xs-text-center" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="arrivalAirport">
                                                    {{row.destination}}
                                                </p>
                                                <p>
                                                    <time itemprop="arrivalTime">
                                                        {{row.arival}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="col-xs-3 nopadding visible-xs text-right">
                                                <div class="col-xs-12 nopadding non-stop text-right">
                                                    <p>
                                                        {{row.stoppage}}
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                    <p itemprop="estimatedFlightDuration">
                                                        {{row.duration}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        {% if returndate  ==  '' or request.GET.rowid%}
                                        <div class="col-xs-12 nopadding mvt10px for-mobile-view">
                                            <!-- main data only mobile -->
                                            <div class="col-xs-12 nopadding text-center custome-edit-block">
                                                <div class="col-xs-12 nopadding mvb10px na-ra">
                                                    <h5 class="econo edit-width-econo"> {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' %}
                                                    {{row.cabintype1}}
                                                    {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %}
                                                    {{row.cabintype2}}
                                                    {% else %}
                                                    {% if request.GET.cabin  ==  'business' or cabin  ==  'business' %}
                                                    {{row.cabintype3}}
                                                    {% endif %}
                                                    {% endif %} </h5>
                                                    <div class="right-data-responsive" itemscope itemtype="http://schema.org/FlightReservation">
                                                        <p class="flight-rate" itemprop="totalPrice">
                                                            {{row.finalprice|intcomma}} Miles +<span>${{row.totaltaxes|floatformat:2}}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-4 col-sm-4 col-xs-12 text-center nopr hidden-xs">
                                        <div class="col-xs-12 nopadding non-stop">
                                            <p>
                                                {{row.stoppage}}
                                            </p>
                                            <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="estimatedFlightDuration">
                                                    {{row.duration}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                <!-- terurn data block -->
                                {% if returndate and row.origin1 %}
                                <div class="col-xs-12 nopadding flight-div-repeat">
                                    <div class="col-md-8 col-sm-8 col-xs-12 nopadding">
                                        <div class="col-xs-12 nopadding">
                                            <div class="arrivel col-sm-5 nopadding col-xs-4" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="departureAirport">
                                                    {{row.origin1}}
                                                </p>
                                                <p>
                                                    <time itemprop="departureTime">
                                                        {{row.departure1}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="arrow-div col-sm-2 col-xs-1 text-center nopadding">
                                                &#8594;
                                            </div>
                                            <div class="arrivel-2 col-sm-4 nopadding text-right col-xs-4 xs-text-center" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="arrivalAirport">
                                                    {{row.destination1}}
                                                </p>
                                                <p>
                                                    <time itemprop="arrivalTime">
                                                        {{row.arival1}}
                                                    </time>
                                                </p>
                                            </div>
                                            <div class="col-xs-3 nopadding visible-xs text-right">
                                                <div class="col-xs-12 nopadding non-stop text-right">
                                                    <p>
                                                        {{row.stoppage1}}
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                    <p itemprop="estimatedFlightDuration">
                                                        {{row.duration1}}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-4 col-xs-12 text-center nopr hidden-xs">
                                        <div class="col-xs-12 nopadding non-stop">
                                            <p>
                                                {{row.stoppage1}}
                                            </p>
                                            <div class="col-xs-12 nopadding non-stop" itemscope itemtype="http://schema.org/Flight">
                                                <p itemprop="estimatedFlightDuration">
                                                    {{row.duration1}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- end retun block -->
                                <div class="col-xs-12 nopadding mvt10px for-mobile-view">
                                    <!-- main data only mobile  if return in present -->
                                    <div class="col-xs-12 nopadding text-center custome-edit-block">
                                        <div class="col-xs-12 nopadding mvb10px na-ra">
                                            <h5 class="econo edit-width-econo"> {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' %}
                                            {{row.cabintype1}}
                                            {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %}
                                            {{row.cabintype2}}
                                            {% else %}
                                            {% if request.GET.cabin  ==  'business' or cabin  ==  'business' %}
                                            {{row.cabintype3}}
                                            {% endif %}
                                            {% endif %} </h5>
                                            <div class="right-data-responsive" itemscope itemtype="http://schema.org/FlightReservation">
                                                <p class="flight-rate" itemprop="totalPrice">
                                                    {{row.finalprice|intcomma}} Miles +<span>${{row.totaltaxes|floatformat:2}}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif%}
                                <a class="show-details" role="button" data-toggle="collapse" href="#{{row.newid}}" aria-expanded="false" aria-controls="collapseExample">SHOW DETAILS</a>
                                <h4 class="econo hidden-xs"> {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin'%}
                                {{row.cabintype1}} {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %} {{row.cabintype2}} {% else%}{{row.cabintype3}} {% endif %}</h4>
                                <div class="col-xs-12 pop-hover nopadding">
                                    <div class="collapse" id="{{row.newid}}">
                                        <!-- Lower change -->
                                        {% if row.multidetail_list %} {% for i in recordlen %} {% with row.multidetail_list|lookup:i as details %}
                                        <h2>Flight {{i|add:1}}</h2>
                                        <div class="table-responsive table-date-search">
                                            <table class="table">
                                                {% with details.departdetails|split:'@' as mylist%} {% with details.arivedetails|split:'@' as mylist1%} {% with details.planedetails|split:'@' as mylist2%} {% with details.operatedby|split:'@' as mylist3%} {% with details.economy_code|split:'@' as mylist4%} {% with details.business_code|split:'@' as mylist5%} {% with details.first_code|split:'@' as mylist6%}
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.0}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.0}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td itemprop="flightNumber"><b>Flight:</b></td>
                                                    <td>{{mylist2.0}}</td>
                                                </tr>
                                                {% if request.GET.cabin  ==  'maincabin' and mylist4.0 %}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist4.0}}</td>
                                                </tr>
                                                {% elif request.GET.cabin  ==  'firstclass' and mylist5.0%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist5.0}}</td>
                                                </tr>
                                                {% else %} {% if mylist6.0%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist6.0}}</td>
                                                </tr>
                                                {% endif%} {% endif %} {% if mylist3.0 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.0}}</td>
                                                </tr>
                                                {% endif %} {% if mylist1.1 %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.1}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.1}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.1}}</td>
                                                </tr>
                                                {% if request.GET.cabin  ==  'maincabin' and mylist4.1 %}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist4.1}}</td>
                                                </tr>
                                                {% elif request.GET.cabin  ==  'firstclass' and mylist5.1%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist5.1}}</td>
                                                </tr>
                                                {% else %} {% if mylist6.1%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist6.1}}</td>
                                                </tr>
                                                {% endif%} {% endif %} {% if mylist3.1 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.1}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if mylist.2 %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.2}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.2}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.2}}</td>
                                                </tr>
                                                {% if request.GET.cabin  ==  'maincabin' and mylist4.2 %}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist4.2}}</td>
                                                </tr>
                                                {% elif request.GET.cabin  ==  'firstclass' and mylist5.2%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist5.2}}</td>
                                                </tr>
                                                {% else %} {% if mylist6.2%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist6.2}}</td>
                                                </tr>
                                                {% endif%} {% endif %} {% if mylist3.2 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.2}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if mylist.3 %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.3}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.3}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.3}}</td>
                                                </tr>
                                                {% if request.GET.cabin  ==  'maincabin' and mylist4.3 %}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist4.3}}</td>
                                                </tr>
                                                {% elif request.GET.cabin  ==  'firstclass' and mylist5.3%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist5.3}}</td>
                                                </tr>
                                                {% else %} {% if mylist6.3%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist6.3}}</td>
                                                </tr>
                                                {% endif%} {% endif %} {% if mylist3.3 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.3}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% if mylist.4 %}
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <h5><b>Change planes </b></h5></td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Departs: </b></td>
                                                    <td>
                                                        <time itemprop="departureTime">
                                                            {{mylist.4}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr itemscope itemtype="http://schema.org/Flight">
                                                    <td><b>Arrives:</b></td>
                                                    <td>
                                                        <time itemprop="arrivalTime">
                                                            {{mylist1.4}}
                                                        </time>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td><b>Flight:</b></td>
                                                    <td>{{mylist2.4}}</td>
                                                </tr>
                                                {% if request.GET.cabin  ==  'maincabin' and mylist4.4 %}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist4.4}}</td>
                                                </tr>
                                                {% elif request.GET.cabin  ==  'firstclass' and mylist5.4%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist5.4}}</td>
                                                </tr>
                                                {% else %} {% if mylist6.4%}
                                                <tr>
                                                    <td><b>Fare Class:</b></td>
                                                    <td>{{mylist6.4}}</td>
                                                </tr>
                                                {% endif%} {% endif %} {% if mylist3.4 %}
                                                <tr>
                                                    <td><b>Operated By:</b></td>
                                                    <td>{{mylist3.4}}</td>
                                                </tr>
                                                {% endif %} {% endif %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %}
                                            </table>
                                        </div>
                                        {%endwith%} {% endfor %}
                                        <a href="#" data-toggle="modal" class="share" data-target="#share-modal" id="{{row.rowid}}">share</a> {% else %}
                                        <!-- upper change -->
                                        <div class="well" itemscope itemtype="http://schema.org/Flight">
                                            <h2>DEPART</h2>
                                            <p itemprop="flightNumber">
                                                {{row.datasource|title}} | {{row.flighno}} ( {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin'%} {{row.cabintype1}} {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %} {{row.cabintype2}} {% else%}{{row.cabintype3}} {% endif %})
                                            </p>
                                            <div class="table-responsive table-date-search">
                                                <table class="table">
                                                    {% with row.departdetails|split:'@' as mylist%} {% with row.arivedetails|split:'@' as mylist1%} {% with row.planedetails|split:'@' as mylist2%} {% with row.operatedby|split:'@' as mylist3%} {% with row.economy_code|split:'@' as mylist4%} {% with row.business_code|split:'@' as mylist5%} {% with row.first_code|split:'@' as mylist6%}
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Departs: </b></td>
                                                        <td>
                                                            <time itemprop="departureTime">
                                                                {{mylist.0}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Arrives:</b></td>
                                                        <td>
                                                            <time itemprop="arrivalTime">
                                                                {{mylist1.0}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td itemprop="flightNumber"><b>Flight:</b></td>
                                                        <td>{{mylist2.0}}</td>
                                                    </tr>
                                                    {% if request.GET.cabin  ==  'maincabin' and mylist4.0 %}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist4.0}}</td>
                                                    </tr>
                                                    {% elif request.GET.cabin  ==  'firstclass' and mylist5.0%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist5.0}}</td>
                                                    </tr>
                                                    {% else %} {% if mylist6.0%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist6.0}}</td>
                                                    </tr>
                                                    {% endif%} {% endif %} {% if mylist3.0 %}
                                                    <tr>
                                                        <td><b>Operated By:</b></td>
                                                        <td>{{mylist3.0}}</td>
                                                    </tr>
                                                    {% endif %} {% if row.stoppage  ==  '1 STOP' or row.stoppage  ==  '2 STOPS' or row.stoppage  ==  '3 STOPS' or row.stoppage  ==  '4 STOPS'%}
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            <h5><b>Change planes </b></h5></td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Departs: </b></td>
                                                        <td>
                                                            <time itemprop="departureTime">
                                                                {{mylist.1}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Arrives:</b></td>
                                                        <td>
                                                            <time itemprop="arrivalTime">
                                                                {{mylist1.1}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Flight:</b></td>
                                                        <td>{{mylist2.1}}</td>
                                                    </tr>
                                                    {% if request.GET.cabin  ==  'maincabin' and mylist4.1 %}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist4.1}}</td>
                                                    </tr>
                                                    {% elif request.GET.cabin  ==  'firstclass' and mylist5.1%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist5.1}}</td>
                                                    </tr>
                                                    {% else %} {% if mylist6.1%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist6.1}}</td>
                                                    </tr>
                                                    {% endif%} {% endif %} {% if mylist3.1 %}
                                                    <tr>
                                                        <td><b>Operated By:</b></td>
                                                        <td>{{mylist3.1}}</td>
                                                    </tr>
                                                    {% endif %} {% endif %} {% if row.stoppage  ==  '2 STOPS' or row.stoppage  ==  '3 STOPS' or row.stoppage  ==  '4 STOPS' %}
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            <h5><b>Change planes </b></h5></td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Departs: </b></td>
                                                        <td>
                                                            <time itemprop="departureTime">
                                                                {{mylist.2}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Arrives:</b></td>
                                                        <td>
                                                            <time itemprop="arrivalTime">
                                                                {{mylist1.2}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Flight:</b></td>
                                                        <td>{{mylist2.2}}</td>
                                                    </tr>
                                                    {% if request.GET.cabin  ==  'maincabin' and mylist4.2 %}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist4.2}}</td>
                                                    </tr>
                                                    {% elif request.GET.cabin  ==  'firstclass' and mylist5.2%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist5.2}}</td>
                                                    </tr>
                                                    {% else %} {% if mylist6.2%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist6.2}}</td>
                                                    </tr>
                                                    {% endif%} {% endif %} {% if mylist3.2 %}
                                                    <tr>
                                                        <td><b>Operated By:</b></td>
                                                        <td>{{mylist3.2}}</td>
                                                    </tr>
                                                    {% endif %} {% endif %} {% if row.stoppage  ==  '3 STOPS' or row.stoppage  ==  '4 STOPS' and mylist.3 %}
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            <h5><b>Change planes </b></h5></td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Departs: </b></td>
                                                        <td>
                                                            <time itemprop="departureTime">
                                                                {{mylist.3}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Arrives:</b></td>
                                                        <td>
                                                            <time itemprop="arrivalTime">
                                                                {{mylist1.3}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Flight:</b></td>
                                                        <td>{{mylist2.3}}</td>
                                                    </tr>
                                                    {% if request.GET.cabin  ==  'maincabin' and mylist4.3 %}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist4.3}}</td>
                                                    </tr>
                                                    {% elif request.GET.cabin  ==  'firstclass' and mylist5.3%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist5.3}}</td>
                                                    </tr>
                                                    {% else %} {% if mylist6.3%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist6.3}}</td>
                                                    </tr>
                                                    {% endif%} {% endif %} {% if mylist3.3 %}
                                                    <tr>
                                                        <td><b>Operated By:</b></td>
                                                        <td>{{mylist3.3}}</td>
                                                    </tr>
                                                    {% endif %} {% endif %} {% if row.stoppage  ==  '4 STOPS' and mylist.4 %}
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            <h5><b>Change planes </b></h5></td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Departs: </b></td>
                                                        <td>
                                                            <time itemprop="departureTime">
                                                                {{mylist.4}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr itemscope itemtype="http://schema.org/Flight">
                                                        <td><b>Arrives:</b></td>
                                                        <td>
                                                            <time itemprop="arrivalTime">
                                                                {{mylist1.4}}
                                                            </time>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Flight:</b></td>
                                                        <td>{{mylist2.4}}</td>
                                                    </tr>
                                                    {% if request.GET.cabin  ==  'maincabin' and mylist4.4 %}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist4.4}}</td>
                                                    </tr>
                                                    {% elif request.GET.cabin  ==  'firstclass' and mylist5.4%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist5.4}}</td>
                                                    </tr>
                                                    {% else %} {% if mylist6.4%}
                                                    <tr>
                                                        <td><b>Fare Class:</b></td>
                                                        <td>{{mylist6.4}}</td>
                                                    </tr>
                                                    {% endif%} {% endif %} {% if mylist3.4 %}
                                                    <tr>
                                                        <td><b>Operated By:</b></td>
                                                        <td>{{mylist3.4}}</td>
                                                    </tr>
                                                    {% endif %} {% endif %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %}
                                                </table>
                                            </div>
                                            <!--  FOR RETURN DELTA BLOCK -->
                                            {% if returndate and row.origin1 %}
                                            <div class="well" itemscope itemtype="http://schema.org/Flight">
                                                <h2>RETURN</h2>
                                                <p itemprop="flightNumber">
                                                    {{row.datasource|title}} | {{row.flighno1}} ({% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin'%} {{row.cabintype11}} {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' %} {{row.cabintype21}} {% else%}{{row.cabintype31}} {% endif %})
                                                </p>
                                                <div class="table-responsive table-date-search">
                                                    <table class="table">
                                                        {% with row.departdetails1|split:'@' as mylist%} {% with row.arivedetails1|split:'@' as mylist1%} {% with row.planedetails1|split:'@' as mylist2%} {% with row.operatedby1|split:'@' as mylist3%} {% with row.economy_code|split:'@' as mylist4%} {% with row.business_code|split:'@' as mylist5%} {% with row.first_code|split:'@' as mylist6%}
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Departs: </b></td>
                                                            <td>
                                                                <time itemprop="departureTime">
                                                                    {{mylist.0}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Arrives:</b></td>
                                                            <td>
                                                                <time itemprop="arrivalTime">
                                                                    {{mylist1.0}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td itemprop="flightNumber"><b>Flight:</b></td>
                                                            <td>{{mylist2.0}}</td>
                                                        </tr>
                                                        {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' and mylist4.0 %}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist4.0}}</td>
                                                        </tr>
                                                        {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' and mylist5.0%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist5.0}}</td>
                                                        </tr>
                                                        {% else %} {% if mylist6.0%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist6.0}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if mylist3.0 %}
                                                        <tr>
                                                            <td><b>Operated By:</b></td>
                                                            <td>{{mylist3.0}}</td>
                                                        </tr>
                                                        {%endif%} {% if row.stoppage1  ==  '1 STOP' or row.stoppage1  ==  '2 STOPS' or row.stoppage1  ==  '3 STOPS' or row.stoppage1  ==  '4 STOPS'%}
                                                        <tr>
                                                            <td></td>
                                                            <td>
                                                                <h5><b>Change planes </b></h5></td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Departs: </b></td>
                                                            <td>
                                                                <time itemprop="departureTime">
                                                                    {{mylist.1}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Arrives:</b></td>
                                                            <td>
                                                                <time itemprop="arrivalTime">
                                                                    {{mylist1.1}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><b>Flight:</b></td>
                                                            <td>{{mylist2.1}}</td>
                                                        </tr>
                                                        {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' and mylist4.1 %}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist4.1}}</td>
                                                        </tr>
                                                        {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' and mylist5.1%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist5.1}}</td>
                                                        </tr>
                                                        {% else %} {% if mylist6.1%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist6.1}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if mylist3.1 %}
                                                        <tr>
                                                            <td><b>Operated By:</b></td>
                                                            <td>{{mylist3.1}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if row.stoppage1  ==  '2 STOPS' or row.stoppage1  ==  '3 STOPS' or row.stoppage1  ==  '4 STOPS'%}
                                                        <tr>
                                                            <td></td>
                                                            <td>
                                                                <h5><b>Change planes </b></h5></td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Departs: </b></td>
                                                            <td>
                                                                <time itemprop="departureTime">
                                                                    {{mylist.2}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Arrives:</b></td>
                                                            <td>
                                                                <time itemprop="arrivalTime">
                                                                    {{mylist1.2}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><b>Flight:</b></td>
                                                            <td>{{mylist2.2}}</td>
                                                        </tr>
                                                        {% if request.GET.cabin  ==  'maincabin' and mylist4.2 %}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist4.3}}</td>
                                                        </tr>
                                                        {% elif request.GET.cabin  ==  'firstclass' and mylist5.2%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist5.2}}</td>
                                                        </tr>
                                                        {% else %} {% if mylist6.2%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist6.2}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if mylist3.2 %}
                                                        <tr>
                                                            <td><b>Operated By:</b></td>
                                                            <td>{{mylist3.2}}</td>
                                                        </tr>
                                                        {% endif %} {% endif %} {% if row.stoppage1  ==  '3 STOPS' or row.stoppage1  ==  '4 STOPS' and mylist.3 %}
                                                        <tr>
                                                            <td></td>
                                                            <td>
                                                                <h5><b>Change planes </b></h5></td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Departs: </b></td>
                                                            <td>
                                                                <time itemprop="departureTime">
                                                                    {{mylist.3}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Arrives:</b></td>
                                                            <td>
                                                                <time itemprop="arrivalTime">
                                                                    {{mylist1.3}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><b>Flight:</b></td>
                                                            <td>{{mylist2.3}}</td>
                                                        </tr>
                                                        {% if request.GET.cabin  ==  'maincabin' or cabin  ==  'maincabin' and mylist4.3 %}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist4.3}}</td>
                                                        </tr>
                                                        {% elif request.GET.cabin  ==  'firstclass' or cabin  ==  'firstclass' and mylist5.3%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist5.3}}</td>
                                                        </tr>
                                                        {% else %} {% if mylist6.3%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist6.3}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if mylist3.3 %}
                                                        <tr>
                                                            <td><b>Operated By:</b></td>
                                                            <td>{{mylist3.3}}</td>
                                                        </tr>
                                                        {% endif %} {% endif %} {% if row.stoppage1  ==  '4 STOPS' and mylist.4 %}
                                                        <tr>
                                                            <td></td>
                                                            <td>
                                                                <h5><b>Change planes </b></h5></td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Departs: </b></td>
                                                            <td>
                                                                <time itemprop="departureTime">
                                                                    {{mylist.4}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr itemscope itemtype="http://schema.org/Flight">
                                                            <td><b>Arrives:</b></td>
                                                            <td>
                                                                <time itemprop="arrivalTime">
                                                                    {{mylist1.4}}
                                                                </time>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><b>Flight:</b></td>
                                                            <td>{{mylist2.4}}</td>
                                                        </tr>
                                                        {% if request.GET.cabin  ==  'maincabin' and mylist4.4 %}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist4.4}}</td>
                                                        </tr>
                                                        {% elif request.GET.cabin  ==  'firstclass' and mylist5.4%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist5.4}}</td>
                                                        </tr>
                                                        {% else %} {% if mylist6.4%}
                                                        <tr>
                                                            <td><b>Fare Class:</b></td>
                                                            <td>{{mylist6.4}}</td>
                                                        </tr>
                                                        {% endif%} {% endif %} {% if mylist3.4 %}
                                                        <tr>
                                                            <td><b>Operated By:</b></td>
                                                            <td>{{mylist3.4}}</td>
                                                        </tr>
                                                        {% endif %} {% endif %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %} {% endwith %}
                                                    </table>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <!-- RETTUN  BLOCK END  -->
                                            {% if action  ==  'depart' %}
                                            <div>
                                                <form action="getsearchresult?keyid={{row.searchkeyid}}&cabin={{request.GET.cabin}}&passenger={{request.GET.passenger}}{% if returndata %}&returnkey={{returndata}}{%endif%}" method="post">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="rowid" value="{{row.rowid}}">
                                                    <input type="hidden" name="price" {% if request.GET.cabin == 'maincabin' or cabin == 'maincabin' %} value="{{row.maincabin}}" {% elif request.GET.cabin == 'firstclass' or cabin == 'firstclass' %} value="{{row.firstclass}}" {% else %}{% if request.GET.cabin == 'business' or cabin == 'business' %} value="{{row.business}}" {%endif%}{% endif %}>
                                                    <input type="hidden" name="tax">
                                                    <input type="hidden" name="action" value="return">
                                                    <input type="hidden" name="datasource" value="{{row.datasource}}">
                                                    <button type "submit" value="{{searchrow.searchid}}" name="return" class="btn btn-pexSearch">
                                                        Other Options For Return Flight
                                                    </button>
                                                </form>
                                            </div>
                                            {% endif %}
                                            <a href="#" data-toggle="modal" class="share" data-target="#share-modal" id="{{row.rowid}}">share</a>
                                            <input type="hidden" value="Anyone want to meet me in  {{search.0.destination}}? I found a great flight for Miles {{row.finalprice|intcomma}} on Pex." class="{{row.finalprice|intcomma}}">
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %} {% endif %}
                        <div id="content1"></div>
                        <div id="content"></div>
                    </div>
                    <div class="col-md-2 col-xs-12 nopadding ">
                        {% if adimages %} {% for images in adimages %} {% if images.image_path %}
                        <img src="{%static images.image_path %}" alt="Responsive image" class="img-responsive"> {% elif images.google_code %} {{images.google_code|safe}} {% endif %} {% endfor %} {% else %}
                        <img src="{% static 'flightsearch/img/ad.jpg' %}" alt="Responsive image" class="img-responsive"> {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center" id="loading_img">
        <img id="loading-image" src="{% static 'flightsearch/js/images/loading.gif' %}" alt="Loading..." />
    </div>
    <p id="back-top">
        <a href="#top"><span class="glyphicon glyphicon-chevron-up"></span> TOP</a>
    </p>
    <a href="staticPage/feedback" class="feedback-btn feedback">
        <button type="button" class="btn btn-warning text-uppercase">
            Feedback
        </button>
    </a>
</div>
<div class="modal fade" id="loading-model" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="nopadding text-center loading-text" id="">
                <span id="loading-info" style="font-size: 20px;"></span>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-7 col-sm-push-5 col-xs-12 login-section">
                        <center>
                            <b>
                            <sapn class="pr5">
                                {{search.0.source}}
                            </sapn> to <span class="pl5">{{search.0.destination}} </span>
                            <p>
                                {{search.0.traveldate}} {%if returndate %} To {{returndate.0}} {%endif%}
                            </p></b>
                            <br>
                            <h4><strong>Want an email when the price tanks?</strong>
                            <br>
                            <small>This will not interfere with your search.</small></h4>
                        </center>
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active">
                                <p id="subs_msg"></p>
                                <form class="modelform">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <input type="email" id="subscription_email" class="form-control" placeholder="Email" name="username" required>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" id="pexdeals" name="pexdeals" value="1"> Email me news and deals from PEX+</label>
                                    </div>
                                    <div class="form-group text-center">
                                        <span type="submit" class="btn btn-info" id="subscribe">Subscribe</span>
                                    </div>
                                    <hr>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-5 col-sm-pull-7 col-xs-12">
                        <div id="loading" align="center">
                            <h4 class="mvt10px hidden-xs">
                                Hang on a minute while we fetch your search results...
                            </h4>
                            <img id="loading-image" src="{% static 'flightsearch/js/images/loading.gif' %}" alt="Loading..." />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--   Loading Model -->
<!-- Modal -->
<div class="modal fade" id="share-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="modal-body">
                <div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#facebook" aria-controls="facebook" role="tab" data-toggle="tab">Facebook</a>
                        </li>
                        <li role="presentation">
                            <a href="#twitter" aria-controls="twitter" role="tab" data-toggle="tab">Twitter</a>
                        </li>
                        <!-- <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Email</a></li>
                        <li role="presentation"><a href="#link" aria-controls="link" role="tab" data-toggle="tab">Link</a></li> -->
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="facebook">
                            <form class="mvt10px mvb10px" action="#" methos="post">
                                <div class="media">
                                    <div class="media-left">
                                        <a href="#"> <img class="media-object" src="{% static 'flightsearch/img/headshot_whitebg.png' %}" alt=""> </a>
                                    </div>
                                    <div class="media-body">
                                        <!--
                                        <div class="form-group">
                                        <textarea rows="3" class="form-control" placeholder="Enter your comment"></textarea>
                                        </div>
                                        -->
                                        <div class="col-xs-12 nopadding">
                                            <div class="col-xs-4 nopadding">
                                                <a href="#"> <img class="media-object fb-share-img" src="{% static 'flightsearch/img/logoMain.png' %}" alt=""> </a>
                                                <input type="hidden" id="recorid" value="">
                                            </div>
                                            <div class="col-xs-8">
                                                <h4 class="media-heading" id="fbtitle"></h4>
                                                <p>
                                                    Hey, I found a great flight on PEX from {{search.0.source}} to {{search.0.destination}}. Join me.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group mvt10px">
                                    <a href="https://www.facebook.com/sharer/sharer.php?u=http://pexportal.com/getsearchresult?keyid={{request.GET.keyid}}%26cabin={{request.GET.cabin}}%26passenger={{request.GET.passenger}}{% if request.GET.returnkey %}%26returnkey={{request.GET.returnkey}}{%endif%}" id="social_share"> <span class="btn btn-pexSearch filter-serch-btn">Post</span> </a>
                                </div>
                            </form>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="twitter">
                            <form class="mvt10px mvb10px">
                                <div class="form-group">
                                    <label>Tweet about this</label>
                                    <textarea id="twitter_content" rows="2" class="form-control" placeholder="Enter your tweet"></textarea>
                                </div>
                                <div class="form-group">
                                    <a href="https://twitter.com/home?status=http://pexportal.com/getsearchresult?keyid={{request.GET.keyid}}%26cabin={{request.GET.cabin}}%26passenger={{request.GET.passenger}}{% if request.GET.returnkey %}%26returnkey={{request.GET.returnkey}}{%endif%}" id="twitter_share"> <span class="btn btn-pexSearch filter-serch-btn">Tweet</span> </a>
                                </div>
                            </form>
                        </div>
                        <!-- <div role="tabpanel" class="tab-pane" id="email">...</div>
                        <div role="tabpanel" class="tab-pane" id="link">...</div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
$('#nodata-msg').empty();
var data_status = false;
var datalist = "{{data.0}}";

if (datalist.length > 0) {
    data_status = true;
}

$(function() {

    $('#departuredate').datepicker({
        minDate: 0,
        onSelect: function() {
            setTimeout(function function_name(argument) {
                $('#return').focus();
            }, 200);

        },
        onClose: function(selectedDate) {
            // Set the minDate of 'to' as the selectedDate of 'from'
            $("#return").datepicker("option", "minDate", selectedDate);
        }
    });
    $('#return').datepicker({
        minDate: 0,
        onSelect: function() {
            /*  setTimeout(function function_name (argument) {
             $('#cabintab').focus();
             },50);
             */
        },
    });
});

$(".flight-search-show").click(function() {
    $(".flight-search-panel").toggleClass('in');
});

$('#passenger').change(function() {
    $('#traveller').val($('#passenger').val());
});

$(document).ready(function() {

    if ("{{request.GET.returnkey}}"  ==  '') {
        //$('.travelers-down-menu').addClass('full-width-res');
        $('.travelers-down-menu').css("left", "-=122");
    }
});
</script>

<script src="{% static 'flightsearch/js/jquery.ui.touch-punch.min.js' %}"></script>
<script>
$(document).ready(function() {
    if (($('.chk-airlines').length) != ($('.chk-airlines:checked').length)) {
        $("#selectairline").prop('checked', false);
    } else {
        $("#selectairline").prop('checked', true);
    }

    if (($('.chk-stoppage').length) != ($('.chk-stoppage:checked').length)) {
        $("#selectallstop").prop('checked', false);
    } else {
        $("#selectallstop").prop('checked', true);
    }

});

//@@@ SELECT ALL CABIN@@@@@@@@@
$(document).ready(function() {

    $("#checkallcabin").on("click", function() {
        if ($(this).is(':checked')) {
            $(".chk").each(function() {
                this.checked = true;

            });
        } else {
            $(".chk").each(function() {
                this.checked = false;
            });
        }
    });
    $(".chk").on("click", function() {
        if (!$(this).is(':checked')) {
            $("#checkallcabin").attr('checked', false);
        }
    });

    //@@@@ SELECT ALL AIRLINES @@@@@@@@@
    //var airlines = {};
    $("#selectairline").on("click", function() {
        if ($(this).is(':checked')) {
            $(".chk-airlines").each(function() {
                this.checked = true;

            });
        } else {
            $(".chk-airlines").each(function() {
                this.checked = false;
            });
        }
    });
    $(".chk-airlines").on("click", function() {
        if (!$(this).is(':checked')) {
            $("#selectairline").attr('checked', false);
        }
    });

    //@@@@ SELECT ALL STOPPAGE @@@@@@@@@

    $("#selectallstop").on("click", function() {
        if ($(this).is(':checked')) {
            $(".chk-stoppage").each(function() {
                this.checked = true;

            });
        } else {
            $(".chk-stoppage").each(function() {
                this.checked = false;
            });
        }
    });
    $(".chk-stoppage").on("click", function() {
        if (!$(this).is(':checked')) {
            $("#selectallstop").attr('checked', false);
        }
    });

});
//  ==  ==  ==  ==  ==  ==  ==  ==  ==  == = time slider ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  == =

var deptmintime;
var arivemintime;
var deptmaxtime;
var arivemaxtime;

var process_status = 'complete';

function timeconversion(time) {
    var val = time;
    var hour;
    ampm = val.split(' ');
    mindepature = ampm[0].split(':');
    hour = mindepature[0];

    if ($.trim(ampm[1]) != "p.m." && $.trim(ampm[1]) != "PM") {

        if (parseInt(hour) > 11) {
            hour = 0;
        }
    } else {
        if (parseInt(hour) < 12) {
            hour = parseInt(hour) + 12;
        } else {
            hour = 0 + 12;
        }

    }
    minute = mindepature[1];
    deptmin = (hour * 60);
    if (minute) {
        deptmin = parseInt(deptmin) + parseInt(minute);
    }

    return deptmin;

}

if ("{{timedata}}") {

    var dept = "{{ timedata.mindept }}";
    if (dept != "None") {
        deptmintime = timeconversion(dept);
    } else {
        deptmintime = 0;
    }

    var arive = "{{ timedata.minarival }}";
    if (arive != "None") {
        arivemintime = timeconversion(arive);
    } else {
        arivemintime = 0;
    }
    var maxdeparture = "{{ timedata.maxdept }}";
    if (maxdeparture != "None") {
        deptmaxtime = timeconversion(maxdeparture);
    } else {
        deptmaxtime = 1439;
    }

    var maxarivaltime = "{{ timedata.maxarival }}";

    if (maxarivaltime != "None") {

        arivemaxtime = timeconversion(maxarivaltime);

    } else {
        arivemaxtime = 1439;
    }
} else {
    deptmintime = 0;
    arivemintime = 0;
    deptmaxtime = 1439;
    arivemaxtime = 1439;

}
/*************************** SLIDER DECTION  ******************************/

$("#depart").slider({
    range: true,
    min: 0,
    max: 1439,
    values: [deptmintime, deptmaxtime],
    slide: function(e, ui) {
        var hours0 = Math.floor(ui.values[0] / 60);
        var minutes0 = ui.values[0] - (hours0 * 60);
        var hours1 = Math.floor(ui.values[1] / 60);
        var minutes1 = ui.values[1] - (hours1 * 60);
        start = getTime(hours0, minutes0);
        end = getTime(hours1, minutes1);
        $('#depaturemin').val(start);
        $('#depaturemax').val(end);
        depaturemin = start;
        depaturemax = end;
        $("#time").text(start + ' - ' + end);
    }

});

var depaturemin = $('#depaturemin').val();
var depaturemax = $('#depaturemax').val();
var arivalmin = $('#arivalmin').val();
var arivalmax = $('#arivalmax').val();

function slideTime1(event, ui) {
    var val0 = $("#depart").slider("values", 0),
        val1 = $("#depart").slider("values", 1),
        hours0 = Math.floor(val0 / 60);
    minutes0 = val0 - (hours0 * 60);
    hours1 = Math.floor(val1 / 60);
    minutes1 = val1 - (hours1 * 60);
    start = getTime(hours0, minutes0);
    end = getTime(hours1, minutes1);
    $('#depaturemin').val(start);
    $('#depaturemax').val(end);
    depaturemin = start;
    depaturemax = end;
    $("#time").text(start + ' - ' + end);
}

$("#arive").slider({
    range: true,
    min: 0,
    max: 1439,
    values: [arivemintime, arivemaxtime],
    slide: function(e, ui) {
        hours0 = Math.floor(ui.values[0] / 60);
        minutes0 = ui.values[0] - (hours0 * 60);
        hours1 = Math.floor(ui.values[1] / 60);
        minutes1 = ui.values[1] - (hours1 * 60);
        startTime = getTime(hours0, minutes0);
        $('#arivalmin').val(startTime);
        endTime = getTime(hours1, minutes1);
        $('#arivalmax').val(endTime);
        arivalmin = startTime;
        arivalmax = endTime;
        $("#arivaltime").text(startTime + ' - ' + endTime);
    }
});

function slideTime(event, ui) {

    var val0 = $("#arive").slider("values", 0),
        val1 = $("#arive").slider("values", 1),
        hours0 = Math.floor(val0 / 60);
    minutes0 = val0 - (hours0 * 60); //parseInt(val0 % 60, 10),
    hours1 = Math.floor(val1 / 60);
    minutes1 = val1 - (hours1 * 60); //parseInt(val1 % 60, 10),

    startTime = getTime(hours0, minutes0);
    $('#arivalmin').val(startTime);
    endTime = getTime(hours1, minutes1);
    $('#arivalmax').val(endTime);
    arivalmin = startTime;
    arivalmax = endTime;
    $("#arivaltime").text(startTime + ' - ' + endTime);
}

function getTime(hours, minutes) {
    var time = null;
    minutes = minutes + "";
    if (hours < 12) {
        time = "AM";
    } else {
        time = "PM";
    }
    if (hours  ==  0) {
        hours = 12;
    }
    if (hours > 12) {
        hours = hours - 12;
    }
    if (minutes.length  ==  1) {
        minutes = "0" + minutes;
    }
    return hours + ":" + minutes + " " + time;
}

slideTime();
slideTime1();

// ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  end time slider ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  == 

$(function() {

    $("#from").autocomplete({
        open: function(event, ui) {
            $('.ui-autocomplete').off('menufocus hover mouseover');
        },
        autoFocus: true,
        source: "/get_airport/",
        minLength: 2,
        select: function(event, ui) {
            $('#fromid').val(ui.item.id);
        },
    });
    $("#to").autocomplete({
        open: function(event, ui) {
            $('.ui-autocomplete').off('menufocus hover mouseover');
        },
        autoFocus: true,
        source: "/get_airport/",
        minLength: 2,
        select: function(event, ui) {
            $('#toid').val(ui.item.id);
        },
    });
});

$(function() {
    if ($(window).width() < 768) {
        $(".filters-holder").addClass('filters-holder-ht');
        $(".show-filter").click(function() {
            $(this).parent().parent().toggleClass('filters-holder-ht');
        });
    }
    $("#cabintab").focus(function() {
        $(".travelers-holder").addClass('open');
        return false;
    });

    $("#cabintab").click(function() {
        $(".travelers-holder").addClass('open');
        return false;
    });

    $(".form_val").focus(function() {
        if (!$(this).hasClass("cabin_type")) {
            $(".travelers-holder").removeClass('open');
        }
    });
});
$('#apply_traveler').click(function() {
    $(".travelers-holder").removeClass('open');
});

$(document).ready(function() {
    $(".alert-warning").hide();
    var tno = '';
    if ("{{request.GET.passenger}}") {
        tno = "{{request.GET.passenger}}";
    } else {
        tno = "{{passenger}}";
    }
    $('#adults').val(tno);
    $('#traveller').val(tno);
    //$('#passenger').val(tno);
    travelinfo();
});

var total;

//@@increase decrease on buttom click
$(function() {
    $('.add').on('click', function() {
        total = tatalpassenger();
        if (total < 6) {
            var $qty = $(this).closest('p').find('.qty');
            var currentVal = parseInt($qty.val());
            if (!isNaN(currentVal)) {
                $qty.val(currentVal + 1);
            }
            travelinfo();
        }
    });
    $('.minus').on('click', function() {
        total = tatalpassenger();
        if (total > 0) {
            var $qty = $(this).closest('p').find('.qty');
            var currentVal = parseInt($qty.val());
            if (!isNaN(currentVal) && currentVal > 0) {
                $qty.val(currentVal - 1);
            }

            travelinfo();
        }
    });

});
$('#cabintype').on('change', function() {
    travelinfo();
});
//@@@Cabin select@@@@


function travelinfo() {
    total = tatalpassenger();
    $('#passenger').val(total);
    var text;
    if (total  ==  1) {
        text = "traveler";
    } else {
        text = "travelers";
    }
    var selectedcabin = $("#cabintype option:selected").text();
    var html = "<span id='travelar'>" + total + " " + text + ", " + selectedcabin + "</span>";
    $('#travelar').replaceWith(html);
    if (total  ==  0) {
        var msg = '';
        $('#submitid').prop('disabled', true);
        $(".alert-warning").empty();
        msg = "You must select atleast one traveler";
        $(".alert-warning").append(msg);
        $(".alert-warning").show();
    } else {
        $('#submitid').prop('disabled', false);
        $(".alert-warning").hide();
    }
}

//@@@Total Passenger@@@@
function tatalpassenger() {
    var sum = 0;
    $('.numberHolder').each(function() {
        sum += parseFloat($(this).val());
    });
    return sum;
};

//@@not close on click dropdown

$('.dropdown-menu .down-menu-block').click(function(e) {
    e.stopPropagation();
});

$('#loading_img').hide();
//@@---------------------- pagination -------------------------------------
var call_sent = "completed";
var pagecount = 2;
var is_data = 1;

$(window).scroll(function() {
    var doch = ($(document).height() - 200);
    var winh = ($(window).height() + 200);
    if ($(window).scrollTop() >= doch - winh) {
        if (is_data > 0) {
            if (call_sent  ==  "completed") {
                loadArticle(pagecount);
                pagecount++;
            }
        }
    }
});

var urls = ("{{request.get_full_path}}");

function loadArticle(pageNumber) {
    call_sent = "in_progress";
    $('#loading_img').show();
    var airline = new Array();
    var stoppage = new Array();
    var fareCodes = new Array();
    var min_prc_param = "";
    var max_prc_param = "";
    var row_val = "";

    if ($('#minPriceMile').val() != '')
        min_prc_param = "&minPriceMile=" + parseInt($('#minPriceMile').val());
    if ($('#maxPriceMile').val() != '')
        max_prc_param = "&maxPriceMile=" + parseInt($('#maxPriceMile').val());

    if ($('#rowid').length)
        row_val = "&rowid=" + $('#rowid').val();

    $(".chk-airlines:checked").each(function() {
        airline.push($(this).val());
    });

    $(".farecode:checked").each(function() {
        fareCodes.push($(this).val());
    });

    $(".chk-stoppage:checked").each(function() {
        stoppage.push($(this).val());
    });

    var multicity = '';
    var multicity1 = "{{request.GET.multicity}}";

    if (multicity1 != '')
        multicity = "&multicity=" + multicity1;

    var stoplenght = stoppage.length;
    var airlinelenght = airline.length;

    $.ajax({
        url: urls,
        type: 'POST',
        data: "action=" + encodeURI('infinite_scroll') + min_prc_param + max_prc_param + "&page_no=" + encodeURI(pageNumber) + "&loop_file=loop&csrfmiddlewaretoken={{ csrf_token }}&depaturemin=" + depaturemin + "&depaturemax=" + depaturemax + "&arivalmin=" + arivalmin + "&arivalmax=" + arivalmax + "&airlines=" + airline + "&fareCodes=" + fareCodes + "&stoppage=" + stoppage + row_val + multicity,
        success: function(html) {
            $("#content").append(html);
            call_sent = "completed";
            $('#loading_img').hide();
            if ($("#nodata").length)
                is_data = 0;
        }
    });
    return false;
}

$(document).ready(function() {

    // hide #back-top first
    $("#back-top").hide();

    // fade in #back-top
    $(function() {
        $(window).scroll(function() {
            if ($(this).scrollTop() > 100) {
                $('#back-top').fadeIn();
            } else {
                $('#back-top').fadeOut();
            }
        });

        // scroll body to 0px on click
        $('#back-top a').click(function() {
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });
    });

});

//  ==  ==  ==  ==  == show/hide details ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  == =
$(document.body).on('click', '.show-details', function() {
    //$('.show-details').on('click',function () {
    var collapse_content_selector = $(this).attr('href');
    var toggle_switch = $(this);
    $(collapse_content_selector).slideToggle(function() {
        $(this).is(':visible') ? toggle_switch.text('HIDE DETAILS') : toggle_switch.text('SHOW DETAILS');
    });
});

var record;
var tweet1;
var tweetcontent;
var fulltext;
var fbcontent;
$(document.body).on('click', '.share', function() {
    var record = $(this).attr("id");
    $('#recorid').val(record);
    tweetcontent = $(this).siblings("input[type='hidden']").val();
    var flight_price = $(this).siblings("input[type='hidden']").attr('class');
    var fbtext = "Miles " + flight_price + " from {{search.0.source}} to {{search.0.destination}}.";
    $('#fbtitle').empty();
    $('#fbtitle').append(fbtext);
    $('#social_share').attr('href', function() {
        fbcontent = this.href + '%26share_recordid=' + record;

    });
    $('#twitter_share').attr('href', function() {
        var fbcontent1 = fbcontent.split("?u=");
        fbcontent1 = tweetcontent + fbcontent1[1];
        var tweet = this.href;
        tweet1 = tweet.split('status=');
        var tweeturl = tweet1[1];
        $('#twitter_content').val(fbcontent1);
        fulltext = tweet1[0] + 'status=' + fbcontent1;
        return this.href = tweet1[0] + 'status=' + fbcontent1;
    });
});
$('#social_share').click(function() {
    window.open(fbcontent, 'newwindow', 'width=600, height=250');
    return false;
});

$('#twitter_content').change(function() {
    var text = $('#twitter_content').val();
    $('#twitter_share').attr('href', function() {
        fulltext = '';
        fulltext = tweet1[0] + 'status=' + text;
    });

});
$('#twitter_share').click(function() {
    window.open(fulltext, 'newwindow', 'width=600, height=250');
    return false;

});

var dataurls = ("{{request.get_full_path}}");
var multicity1 = "{{request.GET.multicity}}";
var searchid = "{{request.GET.keyid}}";
var returnid = "{{request.GET.returnkey}}";
var cabin = "{{request.GET.cabin}}";
var airline = new Array();
var stoppage = new Array();
var row_val = "";
var refreshIntervalId = '';

$('#progress_hidden_val').val('{{progress_value}}');

if ($('#rowid').length)
    row_val = "&rowid=" + $('#rowid').val();

$(".chk-airlines:checked").each(function() {
    airline.push($(this).val());
});

$(".chk-stoppage:checked").each(function() {
    stoppage.push($(this).val());
});

refresh_airline = setInterval(loading, 3000);

var airlines = ["Delta", "United", "Etihad", "S7", "Virgin Atlantic", "Virgin America", "Virgin Australia", "Jetblue", "American", "Aeroflot", "AirChina"];

i = 0;

function loading() {
    $('#loading-info').empty();
    $('#loading-info').append('Searching  ' + airlines[i] + ' Airlines ...');
    i = (i + 1) % airlines.length;
}

var progess_width = 0;
var timecompleted = true;
var callrunning = false;

if (!data_status) // there is no data
{
    $("#loading-model").modal('show');

    if (parseInt($('#progress_hidden_val').val()) > 185) // after data is loaded
    {
        $("#loading-model").modal('hide');
        $('.progress').hide();
        $('.filters-holder').removeClass('xs-filters-holder-ht');
        isprocess();
    } else {
        $('.filters-holder').addClass('xs-filters-holder-ht');
        refreshIntervalId = setInterval(updateTime, 2000);
    }
} else {
    $('.progress').hide();
    $('.filters-holder').removeClass('xs-filters-holder-ht');
    getPriceMatrix();
    getflexData();
    //isprocess();
}

//  ==  ==  ==  ==  ==  ==  ==  ==  ==  == = price slider  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  ==  == =
function priceMileslider(event, ui) {
    var min_miles = $("#miles_slider").slider("values", 0);
    var max_miles = $("#miles_slider").slider("values", 1);
    $('#minPriceMile').val(min_miles);
    $('#maxPriceMile').val(max_miles);
    $("#miles_value").text('Miles ' + min_miles + ' - Miles ' + max_miles);
}

function initialisePriceRange() {
    var minPriceMile = parseInt($('#minPriceMile').val());
    var maxPriceMile = parseInt($('#maxPriceMile').val());
    if ("{{filterkey.minpricemile}}" != 0) {
        minPriceMile = "{{filterkey.minpricemile}}";
        maxPriceMile = "{{filterkey.maxpricemile}}";
    }
    var fix_min_price;
    var fix_max_price;
    if ($('#fix_min_price').val() != 'undefined') {
        fix_min_price = parseInt($('#fix_min_price').val());
        fix_max_price = parseInt($('#fix_max_price').val());
    } else {
        fix_min_price = minPriceMile;
        fix_max_price = maxPriceMile;
    }
    $("#miles_slider").slider({
        range: true,
        min: fix_min_price,
        max: fix_max_price,
        values: [minPriceMile, maxPriceMile],
        slide: function(priceRange, ui) {
            $('#minPriceMile').val(ui.values[0]);
            $('#maxPriceMile').val(ui.values[1]);
            $("#miles_value").text('Miles ' + ui.values[0] + ' -  Miles ' + ui.values[1]);
        }
    });
    priceMileslider();
}

function getPriceMatrix() {
    $.ajax({
        url: dataurls,
        type: 'POST',
        data: "actionfor=prc_matrix&csrfmiddlewaretoken={{csrf_token }}",
        success: function(html) {
            $('#price_matrix').empty();
            $('#price_matrix').append(html);
        }
    });

    $.ajax({
        url: dataurls,
        type: 'POST',
        data: "actionfor=prc_matrix&valuefor=pricerange&csrfmiddlewaretoken={{csrf_token }}",
        success: function(data) {
            $('#minPriceMile').val(data[0]);
            $('#maxPriceMile').val(data[1]);
            $('#fix_min_price').val(data[0]);
            $('#fix_max_price').val(data[1]);
            create_fare_code_filter(data[2]);
            initialisePriceRange();
        }
    });
}
// ----------- Flex data call ----------------------------------//

function getflexData() {
    var searchtype = "{{request.GET.searchtype}}";
    $.ajax({
        type: "POST",
        url: "/getFlexResult/",
        data: {
            "departkey": searchid,
            "searchtype": searchtype,
            "returnkey": returnid,
            csrfmiddlewaretoken: "{{ csrf_token }}"
        },
        success: function(html) {
            //$('#calendarmatix').empty();
            $('#calendarmatix').append(html);
        }
    });
}
var codelen = "{{filterkey.fareCodelength}}";
var codes = "{{filterkey.fareCodes}}";
var code1 = codes.replace(/&quot;/g, '');
code1 = code1.replace('[', '');
code1 = code1.replace(']', '');
code1 = code1.split(',');

function create_fare_code_filter(fareCodeList) {
    var fareCodeDisplay = '';
    for (item = 0; item < fareCodeList.length; item++) {
        codeStatus = '';
        if (codelen > 0)
            for (c = 0; c < codelen; c++)
                if ($.trim(code1[c])  ==  $.trim(fareCodeList[item]))
                    codeStatus = "checked='checked'";
        fareCodeDisplay = fareCodeDisplay + "<div class='checkbox'><label><input type='checkbox' class='farecode' name='fareCodes' value='" + fareCodeList[item] + "'" + codeStatus + "><span></span>" + fareCodeList[item] + "</label></div>";
    }
    $('#add_fare_code').append(fareCodeDisplay);
}

function updateTime() {
    timecompleted = true;
    if (!callrunning)
        isprocess();
}

function redirecttosearchpage(scraperStatus) {
    $.ajax({
        url: dataurls,
        type: 'POST',
        data: "csrfmiddlewaretoken={{ csrf_token }}&depaturemin=" + depaturemin + "&depaturemax=" + depaturemax + "&airlines=" + airline + "&stoppage=" + stoppage + row_val + "&scraperStatus=" + scraperStatus,
        success: function(html) {
            $('.filters-holder').addClass('xs-filters-holder-ht');
            $("#content1").empty();
            $(".contentdiv").remove();
            $("#content1").append(html);

            progess_width = $('#progressbar').width();
            $('#progress_hidden_val').val(progess_width);

            if (progess_width < 195)
                progess_width = parseInt(progess_width) + 12;

            $('#progressbar').width(progess_width);
            // needs to reload the data
            is_data = 1;
            pagecount = 2;
            $('#content').empty();

            if (scraperStatus  ==  'complete') {
                $('#progressbar').css("width", "100%");
                $('#progress_hidden_val').val('195');
                //clearInterval(refreshIntervalId);
                $('#progressbar').text('');
                $('.progress').hide();
                $("#loading-model").modal('hide');
                $('.filters-holder').removeClass('xs-filters-holder-ht');

                if ($('#nodata').length > 0 && $('#datafound').length <= 0)
                    $('#nodata-msg').append("Oops, looks like there aren't any flight results for your filtered search. Try to broaden your search criteria for better results.");
            }
        }
    });
}

var dataCheckCount = 0;
var timeCount = 0;
var isDataComplete = '';
var multicity = '';
var multicity1 = "{{request.GET.multicity}}";

function isprocess() {
    callrunning = true;
    timecompleted = false;
    var temp = '';

    if (returnid != '')
        var temp = "&returnkey=" + encodeURI(returnid);

    if (multicity1 != '')
        multicity = "&multicity=" + encodeURI(multicity1);

    $.ajax({
        type: "POST",
        url: "/checkData/",
        data: "keyid=" + encodeURI(searchid) + "&csrfmiddlewaretoken={{ csrf_token }}" + "&cabin=" + encodeURI(cabin) + temp + multicity,
        success: function(data) {
            callrunning = false;

            if (timeCount >= 9 && data[0] != 'onprocess') // after 2 * 9 seconds hide the dialog
                $("#loading-model").modal('hide');
            else
                timeCount = parseInt(timeCount) + 1;

            if (timecompleted && data[1] != 'completed')
                isprocess();

            if (data[1]  ==  'key_expired') {
                clearInterval(refreshIntervalId);
                $('changebtnid').click();

                setSearchData();
            }

            if (data[1]  ==  'completed' || dataCheckCount > 60) {
                clearInterval(refreshIntervalId);
                redirecttosearchpage('complete');
                getPriceMatrix();
                getflexData();
            } else if (data[0] != 'onprocess' && dataCheckCount % 3  ==  0) {
                redirecttosearchpage('onprocess');
            }

            dataCheckCount++;
        },
    });
}

$('#subscribe').click(function() {
    var is_checked = '';
    var subscription_email = $('#subscription_email').val();
    if (subscription_email != '') {
        if ($('#pexdeals').is(':checked')) {
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "/mailchimp/",
                data: "email=" + encodeURI(subscription_email) + "&csrfmiddlewaretoken={{ csrf_token }}",
                success: function(resp) {
                    $('#subs_msg').empty();
                    $('#subs_msg').append(resp);
                    setTimeout(function() {
                        $('#subs_msg').fadeOut();
                    }, 8000);
                }
            });
        } else {
            alert("please click on news and deals from PEX+");
        }
    } else {
        alert("please enter your valid email");
    }
});

var CSRF_TOKEN = "{{ csrf_token }}";
var triptype = '';
var destinationid = '';
var sourceid = '';
var returndateval = '';
var departdateval = '';
var rdtrip = '';
var trip = '';
var cabintypeval = '';
var searchidval = '';
var returnidval = '';
$("#changebtnid").click(function(event) {
    //event.preventDefault();
    setSearchData();
});

function setSearchData() {
    event.preventDefault();
    sourceid = $('#fromid').val();
    destinationid = $('#toid').val();
    var isReturndate = '';
    isReturndate = "{{returndate}}";
    if (isReturndate != '') {
        returndateval = $('#return').val();
    }
    departdateval = $('#departuredate').val();
    cabintypeval = $('#cabintype option:selected').val();
    searchData();
}

function searchData() {
    $('#changebtnid').prop('disabled', true);
    $("#content1").empty();
    var searchtype = "{{request.GET.searchtype}}";

    $.ajax({
        type: "POST",
        url: "/search/",
        data: "returndate=" + encodeURI(returndateval) + "&searchtype=" + encodeURI(searchtype) + "&rndtripkey=" + encodeURI(rdtrip) + "&cabin=" + encodeURI(cabintypeval) + "&triptype=" + encodeURI(trip) + "&fromMain=" + encodeURI(sourceid) + "&toMain=" + encodeURI(destinationid) + "&deptdate=" + encodeURI(departdateval) + "&csrfmiddlewaretoken=" + encodeURI(CSRF_TOKEN),
        success: function(data) {
            searchtype = data['searchtype'];
            multikey = data['departkey']; //data[0];
            searchid1 = multikey.split(',');
            searchid = searchid1[0];
            var returnid = '';

            if (data['returnkey']) {
                returnid = data['returnkey'];
            }
            getsearchresult(searchid, returnid, searchtype);
            //getsearchresult(searchidval, returnidval);
            //refreshIntervalId = setInterval(datacheck, 5000,searchid,returnid);
        },
        error: function(ret) {
            msg = 'You reached the daily flight search limit!';
            if (ret.responseText  ==  "2") {
                msg += '\nPlease sign up and get more access!';
                var r = confirm(msg);
                if (r  ==  true)
                    $('#login-modal').modal();
            } else if (ret.responseText  ==  "1") {
                alert(msg);
            } else {
                alert('You reached the flight search limit!\nPlease purchase more!');
            }

            return false;
        }
    });
}

function getsearchresult(searchidval, returnidval, searchtype) {
    multicity = '';
    if (multikey.indexOf(",") >= 0) {
        multicity = "&multicity=" + encodeURI(multikey);
    }
    if (searchidval != '') {
        $('#searchid').val(searchid);
        var location = "getsearchresult?keyid=" + encodeURI(searchidval) + "&cabin=" + encodeURI(cabintypeval) + "&passenger=" + encodeURI($('#passenger').val()) + multicity;
        if (returnidval != '') {
            location = location + "&returnkey=" + encodeURI(returnidval);
        }
        location = location + "&searchtype=" + encodeURI(searchtype);
        window.location.href = location;
    }
}
</script>
{% endblock %}