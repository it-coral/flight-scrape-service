{% load staticfiles %}
{% load humanize %}
		{% include "flightsearch/header.html" %}
	    <div class="col-xs-12 nopadding form-cstm-mng" style="">
	    <h3 class="text-center">My Reward Points</h3>
	    {% if updatemsg %}<h4 class="text-center"> {{updatemsg}}</h4> {%endif%}
		<div class="col-xs-12 col-sm-10 col-sm-push-1 mng-act fr-pd" style="padding: 30px 10px !important;">
			
			
			{% if message %}
			<div class="alert alert-warning">{{message}}</div>
			{% endif %}
			<div class="">
			<div class="col-xs-12 col-md-9 nopadding">
			
			<div class="col-xs-12 nopadding">
				<div class="col-xs-12 nopadding">
				<div class="col-xs-3 text-center"><b><u>Airlines</u></b></div>
				<div class="col-xs-3 text-center"><b><u>Points</u></b></div>
				<div class="col-xs-3 text-center"><b><u>Last Updated</u></b></div>
				<div class="col-xs-3 text-center"><b><u>Action</u></b></div>
				</div>
					{% if points %}
				{% for row in points%}
					<div class="col-xs-12 nopadding rewardpoint" style="padding-bottom: 10px" id="{{row.3}}_div">	
					<div class="col-xs-3 text-center">{{row.3|title}}</div>
					<div class="col-xs-3 text-center">{{row.2}} Miles</div>
					<div class="col-xs-3 text-center nopadding">{{row.4}}</div>
					<div class="col-xs-3 text-center"><a href="#" id="{{row.3}}" class="update"> Update</a>
						| <a href="#" id="{{row.3}}_{{ request.session.userid }}" class="deactivate">Deactivate</a>
					</div>
					</div>
					<div class="col-xs-12 nopadding" style="padding-bottom: 10px" id ="div_{{row.3}}"></div>
				{% endfor %}
				{% endif %}	
			</div>
			
			</div>
			<div class="col-xs-12 col-md-2 text-right cstm-btn">
				<button class="btn btn-pexSearch" id="add_account">Add Account</button>
			</div>
			
			</div>
		<div class="col-xs-12 form-group" style="padding: 15px 0 0 0">
			<div class="col-xs-12 nopaddig" style="padding-bottom: 20px">
				<span style="margin-bottom: 40px">{{temp_message}} </span>	
			</div>
		<form class="form-inline" id="addaccount"  method="post" action="myRewardPoint">
		  {% csrf_token %}
		  <div class="col-md-12 col-xs-12 nopadding form-reward">
		  <div class="col-md-3 form-group">
		    <label for="username">Username</label>
		    <input type="text" name="username" class="form-control" id="" placeholder="USERNAME" required>
		  </div>
		  <div class="col-md-3 form-group">
		    <label for="username">Account Number</label>
		    <input type="text" name="skymiles_number" class="form-control" id="" placeholder="ACCOUNT NUMBER" required>
		  </div>
		  <div class="col-md-3 form-group">
		    <label for="password">Password</label>
		    <input type="password" name="password" class="form-control" id="" placeholder="PASSWORD" required>
		  </div>
		  <div class="col-md-3 form-group">
		    <label for="password">Select Airline</label>
		    <select name="airline" class="form-control" required id="airline_Select">
		    	<option value="">Select Airline</option>
		    	{% if 'delta' not in datasource%}
		    		<option value="delta">Delta</option>
		    	{% endif %}
		    	{% if 'united' not in datasource%}
		    		<option value="united">United</option>
		    	{% endif %}
		    	{% if 'virgin' not in datasource%}
		    	<option value="virgin">Virgin Atlantic</option>
		    	{%endif%}
		    </select>
		    </div>
			</div>
		  <div class="form-group pd-fm-btn" style="margin-top:15px;">

		  <button type="submit" id="syncdata" class="btn btn-pexSearch">Sync</button></div>
		</form>
		</div>
		</div>	
		</div>
		
			
		</div>
		
		<div class="">
	{% include "flightsearch/footer.html" %}
	</div>
	<script>
	
	
		$('#syncdata').click(function(){
			//$('#syncdata').prop('disabled', true);
		});
		$(document).ready(function(){
			var action = '';
			action ="{{temp_message}}";
			if (action == '')
			{
				$('#addaccount').hide();
			}
					
		});
		$('#add_account').click(function(){
			 if ($(this).text() == "Add Account") 
			  { 
			  	$('#addaccount').show();
			     $(this).text("Cancel"); 
			  } 
			  else 
			  { 
			     $(this).text("Add Account"); 
			     $('#addaccount').hide();
			  }; 
		});
		
		
	
		$('.update').click(function(){
			var html= '';
			var id = ($(this).attr('id'));
			if ($(this).text().trim() == "Update") {
				$(this).text("Cancel");
				$('#div_'+id).empty();
				html = "<form method='post' class='form-inline' action='myRewardPoint' id='form_"+id+"'>{% csrf_token %}<input type='hidden' name='rowid' value='"+id+"'><div class='col-md-12 col-xs-12 nopadding form-reward'><div class='col-md-3 form-group'><input type='text' name='username' placeholder='USERNAME' class='form-control' required></div><div class='col-md-3 form-group'><input type='password' class='form-control' name='password' placeholder='PASSWORD' required></div><div class='col-md-3 form-group'><input type='text' class='form-control' name='skymiles_number' placeholder='ACCOUNT NUMBER' required></div><div class='col-md-3 form-group'><button type='submit' class='updatebtn btn btn-pexSearch form-control' id='btn_"+id+"'>Update</button></div></div></form>";
				$('#div_'+id).append(html);
			}
			else{
				$('#div_'+id).empty();
				$(this).text("Update");
			}
			
		});
		$('.deactivate').click(function(){
			var airline = $(this).attr('id');
			airlines = airline.split('_');
			
		
			var r = confirm("Are You sure, you want to deactivate your account!");
			if (r == true) 
			{	
				$("#"+airlines[0]+"_div").hide();
				//$("#"+airline).parent('.rewardpoint').hide();
				$.ajax({
		       	type: "POST",
		       	dataType: "text",
		       	url: "/myRewardPoint/",
		        data: "act="+encodeURI("deactive")+"&csrfmiddlewaretoken="+encodeURI("{{csrf_token}}")+"&acct="+encodeURI(airlines[0])
		        }).done(function(data){
			      	$("#"+airlines[0]+"_div").remove();
			      	$('#airline_Select').append($('<option>', {
					    value: airlines[0],
					    text: airlines[0]
					}));
			      }) ;
			    
			} 
		});
		/*
		$('.updatebtn').on("click", function(){
			console.log('test');
			var fromid = $(this).attr('id');
			formid = formid.split('_');
			alert(formid[1]);
			//updateCredential();
		});
		function updateCredential(formid)
		{
			call_sent = 'progress';
			$('.updateform').submit(function(event) {
				var formdata = {'username': $('input[name=username]').val(),
								'password': $('input[name=password]').val(),
								'password': $('input[name=skymiles_number]').val(),
							   };
				$.ajax({
                        url:"myRewardPoint",
                        type:'POST',
                        data: "action="+encodeURI('infinite_scroll')+"&page_no="+encodeURI(pageNumber)+ "&loop_file=loop&csrfmiddlewaretoken={{ csrf_token }}&depaturemin="+depaturemin+"&depaturemax="+depaturemax+"&airlines="+airline+"&stoppage="+stoppage+row_val+multicity, 
                        success: function(){
						call_sent = "completed";
                           console.log(call_sent);
                         }
                });
         	});
		}
		*/
		 
	</script>
	<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>');</script>
    <script src="/static/flightsearch/js/vendor/bootstrap.min.js"></script>
    